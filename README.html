<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="author" content="Gabriele Puliti">
<title>LearningNeo4j</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock pre.nowrap,.literalblock pre.nowrap pre,.listingblock pre.nowrap,.listingblock pre.nowrap pre{white-space:pre;word-wrap:normal}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #dddddf}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
<h1>LearningNeo4j</h1>
<div class="details">
<span id="author" class="author">Gabriele Puliti</span><br>
<span id="email" class="email"><a href="mailto:gabriele.puliti@gmail.com">gabriele.puliti@gmail.com</a></span><br>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_graph_database_fundamentals">Graph Database Fundamentals</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A graph database can store any kind of data using a few simple concepts:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Nodes</strong> - graph data records</p>
<div class="paragraph">
<p><span class="image"><img src="resources/nodes.PNG" alt="nodes"></span></p>
</div>
</li>
<li>
<p><strong>Labels</strong> - specifies the type of the node</p>
<div class="paragraph">
<p><span class="image"><img src="resources/nodesTypes.PNG" alt="nodesTypes"></span></p>
</div>
</li>
<li>
<p><strong>Relationships</strong> - connect nodes</p>
<div class="paragraph">
<p><span class="image"><img src="resources/nodesTypesRelationships.PNG" alt="nodesTypes"></span></p>
</div>
</li>
<li>
<p><strong>Properties</strong> - key-value pair properties</p>
<div class="paragraph">
<p><span class="image"><img src="resources/nodesTypesRelationshipsProperties.PNG" alt="nodesTypes"></span></p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The simplest graph has just a single <strong>node</strong> with some named values
called <strong>Properties</strong>:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="resources/simpleGraph.PNG" alt="simpleGraph"></span></p>
</div>
<div class="paragraph">
<p>Nodes are the name for data records in a graph and the data is stored as
Properties that can be simple key-value pairs.</p>
</div>
<div class="paragraph">
<p>Nodes can be grouped together by applying a Label to each member. In the
example above we can set to that node the label <strong>Person</strong>. Is important
to know that a label is not a object and can’t have any properties, is
used only to categorize the nodes in a graph. A node can have zero or
more labels based on the definition of that node.</p>
</div>
<div class="paragraph">
<p>To add more records we can simply add more nodes.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="resources/moreNodes.PNG" alt="moreNodes"></span></p>
</div>
<div class="paragraph">
<p>Similar nodes can have different properties with different type: string,
number or even boolean. The dimension of a graph like this can be
infinite because there is no limit to the number of nodes that can be
added.</p>
</div>
<div class="paragraph">
<p>One of the properties of a database is to connect data, in a graph
database the link is made by <strong>Relationships</strong>. To associate two nodes we
can add <strong>Relationship</strong> between them wich describe how the records are
related.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="resources/relationships.PNG" alt="relationships"></span></p>
</div>
<div class="paragraph">
<p>A relationship are data records that need to have two properties:
<strong>direction</strong> and <strong>type</strong>, and can also contains properties like nodes.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="resources/relationshipProperties.PNG" alt="relationshipProperties"></span></p>
</div>
<div class="paragraph">
<p>A Graph database is an online database management system with Create,
Read, Update and Delete (CRUD) operations working on a graph data model.
Graph database are generally build for use with <a href="#otlp">OLTP</a>
systems, they are normally optimized for transactional performance, and
engineered with transactional integrity and operational availability in
mind.</p>
</div>
<div class="paragraph">
<p>Unlike the other databases, relationships take first priority in graph
databases so the foreign keys or out-of-band processing is no more
necessary to link a data to another.</p>
</div>
<div class="paragraph">
<p>By assembling the simple abstractions of nodes and relationships into
connected structures, graph databases enable us to build sophisticated
models that map closely to out problem domain.</p>
</div>
<div class="paragraph">
<p>Many applications’ data is modeled as relational data, indeed there are
some similarities between a relational model nad a graph model:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Relational</th>
<th class="tableblock halign-left valign-top">Graph</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rows</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nodes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Joins</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Relationships</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Table names</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Labels</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">columns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Properties</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>There are even difference between this two databases:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Relational</th>
<th class="tableblock halign-left valign-top">Graph</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Each column must have field value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nodes with the same label arent’
required to have the same set of properties</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Joins are calculated at query time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Relationships are stored on disk
when they are created</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">A row can belong to one table</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A node can have many labels</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Try to get the schema defined and then make minimal changes to it after
that</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">It’s common for the schema to evolve with the application</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">More abstract focus when modeling</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Common to use actual data items when
modeling</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Here is the relational model:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="resources/relationalModelClubs.PNG" alt="relationalModelClubs"></span></p>
</div>
<div class="paragraph">
<p>And here is the correspondig graph model:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="resources/graphModelClubs.PNG" alt="graphModelClubs"></span></p>
</div>
<div class="paragraph">
<p>The graph model can be more versatile and can be upgrade without
efforts, for example we want to add the confederation and country:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="resources/graphModelClubsExtend.PNG" alt="graphModelClubsExtend"></span></p>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_neo4j">Neo4J</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image"><img src="resources/HelloWorld.PNG" alt="HelloWorld"></span></p>
</div>
<div class="paragraph">
<p><a href="https://www.youtube.com/watch?v=_D19h5s73Co">video youtube</a></p>
</div>
<div class="paragraph">
<p>Connected information is everywhere in the world around us. Neo4j was
build to efficiently store, handle, and query higly-connected data in
your data model.</p>
</div>
<div class="paragraph">
<p>Neo4J is a high performance graph store with all the feature expected of
a mature and robust database. The network structure is made by nodes and
relationships rather than static tables.</p>
</div>
<div class="paragraph">
<p>Some definitions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Index free adjacency</p>
<div class="paragraph">
<p>With index free adjaceny, when a node or relationship is written to the
database, it is stored in the database as connected and any subsequent
access to the data is done using pointer navigation wich is very fast.
Since Neo4j is a native graph database, it supports very large graphs
where connected data can be traversed in constant time without the need
for an index.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="resources/neo4jIndex.PNG" alt="Neo4j index"></span></p>
</div>
<div class="paragraph">
<p>To know more read &#8594; <a href="#index-free-adjacency">Index-free adjacency</a></p>
</div>
</li>
<li>
<p>ACID</p>
<div class="paragraph">
<p>Transactionality is very important for robust applications that require
an atomicity, consistency, isolation, and durability guarantees for
their data. If a relationship between nodes is created, not only is the
relationship created, but the nodes are updated as connected. All of
these updates to the database must all succeed or fail.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="resources/neo4jACID.PNG" alt="Neo4j ACID"></span></p>
</div>
<div class="paragraph">
<p>To know more read &#8594; <a href="#acid-consistency-model">ACID</a></p>
</div>
</li>
<li>
<p>Clusters</p>
<div class="paragraph">
<p>Neo4j supports clusters that provide high availablity, scalability for
read access to the data and failover which is important to many
enterprises.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="resources/neo4jCluster.PNG" alt="neo4jCluster"></span></p>
</div>
<div class="paragraph">
<p>To know more read &#8594; <a href="#cluster">Cluster</a></p>
</div>
</li>
<li>
<p>Graph engine</p>
<div class="paragraph">
<p>The Neo4j graph engine is used to interpret Cypher statements and also
executes kernel-level code to store and retrive data, whether it is on
disk, or cached in memory.</p>
</div>
</li>
<li>
<p>Bolt</p>
<div class="paragraph">
<p>Neo4j supports Java, JavaScript, Python, C#, and Go drivers that use
Neo4j’s bolt protocol for binary access to the database layer. Bolt is
an efficiant binary protocol that compresses data sent over the wire as
well encrypting the data. It’s possible to create a java application
that uses the bolt driver to access the Neo4j database and the
application may use other packages that allow data integration between
Neo4j and other data stores or uses as common framework such as spring.</p>
</div>
</li>
<li>
<p>Tools</p>
<div class="paragraph">
<p><a href="https://neo4j.com/sandbox-v2/">Neo4j browser</a> is an application that uses
the JavaScript Bolt driver to access the graph engine of the Neo4j
database server.</p>
</div>
<div class="paragraph">
<p><a href="https://neo4j.com/bloom/">Bloom</a> enables you to visualize a graph without
knowing much about Cypher
(<a href="https://www.youtube.com/watch?v=KjINhGbG-So">youtube video</a>).</p>
</div>
<div class="paragraph">
<p><a href="https://neo4j.com/developer/neo4j-etl/">ETL</a> used to importing and
exporting data between flat files and a neo4j Database.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="resources/neo4jStructure.PNG" alt="neo4jStructure"></span></p>
</div>
<div class="paragraph">
<p>To use Neo4j there are two options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://neo4j.com/developer/neo4j-desktop/">desktop application</a></p>
<div class="paragraph">
<p>" The Neo4j Desktop includes the Neo4j Database server which includes
the graph engine and kernel so that Cypher statements can be executed to
access a database on your system. It includes an application called
Neo4j Browser. Neo4j Browser enables you to access a Neo4j database
using Cypher. You can also call built-in procedures that communicate
with the database server. There are a number of additional libraries and
drivers for accessing the Neo4j database from Cypher or from another
programming language that you can install in your development
environment. If you are looking to use your system for application
development and you want to be able to create multiple Neo4j databases
on your machine, you should consider downloading the Neo4j Desktop (free
download). The Neo4j Desktop runs on OS X, Linux, and Windows. "</p>
</div>
<div class="paragraph">
<p>How to use on:
1.  OSX: <a href="https://www.youtube.com/watch?v=8yWhuUnPapw">youtube video</a>
2.  Windows: <a href="https://www.youtube.com/watch?v=EO57N03U_sI">youtube video</a>
3.  Linux: <a href="https://www.youtube.com/watch?v=SGH_5x3kfdw">youtube video</a></p>
</div>
</li>
<li>
<p><a href="https://neo4j.com/sandbox-v2/">browser sandbox</a></p>
<div class="paragraph">
<p>" The Neo4j sandbox is another way that you can begin development with
Neo4j. It is a temporary, cloud-based instance of a Neo4j Server with
its associated graph that you can access from any Web browser. The
database in a Sandbox may be blank or it may be pre-populated. It is
started automatically for you when you create the Sandbox.</p>
</div>
<div class="paragraph">
<p>By default, the Neo4j sandbox is available for three days, but you can
extend it for up to 10 days. If you do not want to install Neo4j Desktop
on your system, consider creating a Neo4j sandbox. You must make sure
that you extend your lease of the sandbox, otherwise you will lose your
graph and any saved Cypher scripts you have created in the sandbox.
However, you can use Neo4j Browser Sync to save Cypher scripts from your
sandbox. We recommend you use the Desktop for a real development
project. The Sandbox is intended as a temporary environment or for
learning about the features of Neo4j as well as specific graph
use-cases. "</p>
</div>
<div class="paragraph">
<p><a href="https://www.youtube.com/watch?v=rmfgRKPjhl8">youtube video - Creating a
Neo4j Sandbox</a></p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both of them use Neo4j Browser application to perform querying in the
database &#8594;
<a href="https://www.youtube.com/watch?v=rQTximyaETA">GettingStartedBrowser</a></p>
</div>
<hr>
<div class="sect2">
<h3 id="_cypher">Cypher</h3>
<div class="paragraph">
<p><strong><em>This notes below can be read on neo4J browser sandbox by type the
command: :play cypher</em></strong></p>
</div>
<div class="paragraph">
<p><strong><em>All of the query are run in the <a href="https://neo4j.com/sandbox-v2">Neo4J
browser sandbox</a> or on <a href="https://neo4j.com/download/">Neo4J desktop</a></em></strong></p>
</div>
<div class="paragraph">
<p>Neo4J’s Cypher language is purpose built for working with graph data, is
a declarative query language that allows for expressive and efficient
querying and updating of graph data. It uses patterns to describe graph
data and is familiar to sql-like clauses. This query language allows
users to store and retrive data from the Neo4J graph database with a
visual and logical syntax to match patterns of nodes and relationships
in the graphs. It allow to state what we want to select, insert, update,
or delete from our graph data without a description of exactly how to do
it:</p>
</div>
<div class="sect4">
<h5 id="_describing_what_to_find_and_not_how_to_find_it"><strong>" Describing what to find and not how to find it "</strong></h5>
<div class="paragraph">
<p>This means that complex database queries can easily be expressed through
Cypher, allowing you to focus on your domain instead of getting lost in
the syntax of database access. Also give an expressive and efficient
queries to handle needed create, read, update, and delete functionality
(also know as CRUD operations).</p>
</div>
<div class="paragraph">
<p>The unwritten rule wants to rappresents the nouns as the nodes of the
graph, the verbs as the relationships, the adjectives and adverbs are
the properties:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="resources/unwrittenRule.PNG" alt="unwrittenRule"></span></p>
</div>
<div class="paragraph">
<p>Graph patterns are expressed in Cypher using ASCII-art like syntax to
make queries more self-explanatory:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>NODES</strong> uses a pair of parentheses like <code>()</code> or <code>(node)</code> to rapresent
a node, similar to a circle on witheboard. An anonymous node <code>()</code>
represents one or more nodes during a query processing where there are
no restrictions of the type of the node, a name inside the parentheses
<code>(node)</code> tells the query processor that for this query is used the
variable called <code>node</code> to rapresents all the nodes of the graph.</p>
</li>
<li>
<p><strong>LABELS</strong> are used to group nodes and filter queries against the graph
and is defined with a colon <code>(:Label)</code>. A node can have zero or more
labels for example <code>(node)</code>, <code>(node:Label)</code>, <code>(node:Label1:Label2)</code>,
<code>(:Label)</code>, <code>(:Label1:Label2)</code>.</p>
</li>
<li>
<p><strong>RELATIONSHIPS</strong> are defined within square brackets <code>[]</code> and optionally
we can specify type and direction like <code>()&#8592;[:RELATIONSHIP]-()</code>.</p>
</li>
<li>
<p><strong>ALIASES</strong> are used to referred elements to later in the query defined
by a name before a name like
<code>(node1:Label1)&#8592;[relationship:RELATIONSHIP]-(node2:Label2)</code> where
node1, node2 and relationship are aliases.</p>
</li>
<li>
<p><strong>Predicates</strong> are filters that can be applied to limit the matching
paths: boolean logi operators, <a href="#regular-expressions">regular
expressions</a> and string comparison operators.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The properties of a node are accessed using <code>{variable}.{property_key}</code>,
for example <code>emil.name</code> or <code>movie.title</code>.</p>
</div>
<div class="paragraph">
<p>The Cypher language are case insensitive and sensitive:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Sensitive</th>
<th class="tableblock halign-left valign-top">Insensitive</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node labels</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cypher keywords</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Relationship type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">—–</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property keys</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">—-</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Later on the cypher keywords are upper-case, this is a coding convention
and is described in the
<a href="https://neo4j.com/developer/cypher-style-guide/">Cypher Style Guyide</a>.</p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="_part_one">Part one</h4>
<div class="sect4">
<h5 id="_comments">Comments</h5>
<div class="paragraph">
<p>You can place comments anywhere in the query and to specify that the
rest of the line is interpreted as a comment you need to put a double
slash <code>// comment</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_null">Null</h5>
<div class="paragraph">
<p>Null represents missing or undefined values. You do not store a null
value in a property. It just doesen’t exist on that particular node.
<strong>Warning: null=null is not true but the result will be null because we
don’t know the value of a null property</strong></p>
</div>
</div>
<div class="sect4">
<h5 id="_match">Match</h5>
<div class="paragraph">
<p><strong><em>on neof4j browser run the command `:help MATCH`</em></strong></p>
</div>
<div class="paragraph">
<p><a href="https://www.youtube.com/watch?v=Sz2C618QKN8">youtube video - how to
execute a MATCH statement</a></p>
</div>
<div class="paragraph">
<p>The most widely used Cypher clause is <strong>MATCH</strong>, this performs a pattern
match against the data in the graph. During the query processing, the
graph engine traverses the graph to find all nodes that match the graph
pattern.</p>
</div>
<div class="paragraph">
<p>A query with match need to be present with the <strong>RETURN</strong> clause. This
clause must be the last of a query to the graph. Here some examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">// returns all nodes in the graph
MATCH (variable)
RETURN variable</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">// returns all Label nodes in the graph
MATCH (variable:Label)
RETURN variable // returns</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you specify a pattern for a <strong>MATCH</strong> clause, you should always
specify a node label if possible. In doing so, the graph engine uses an
index to retrive the nodes which will perform better than not using a
label for the <strong>MATCH</strong>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_type_of_query_output">Type of query output</h5>
<div class="paragraph">
<p>The output of a query can be different:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>by <strong>graph</strong>:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="resources/matchEmilReturnG.PNG" alt="matchEmilReturnG"></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>by <strong>table</strong>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "name": "Emil",
    "from": "Sweden",
    "klout": 99
}</code></pre>
</div>
</div>
</li>
<li>
<p>by <strong>text</strong>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-column" data-lang="column">╒══════════════════════════════════════════╕
│"ee"                                      │
╞══════════════════════════════════════════╡
│{"name":"Emil","from":"Sweden","klout":99}│
└──────────────────────────────────────────┘</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_exercises_part_one">Exercises part one</h5>
<div class="paragraph">
<p><strong><em>on neof4j browser run the command <code>:play intro-neo4j-exercises</code> and
follow exercise 1 instructions</em></strong></p>
</div>
<div class="paragraph">
<p>First of all use the script found at
Cypher/exercises/part_one/createGraph.cql to create the basic graph:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">Added 171 labels, created 171 nodes, set 564 properties, created 253 relationships, completed after 24 ms.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 1.1 Retrive all nodes from the database</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (n)
RETURN n</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="image"><img src="resources/partOneExercise_1_1.PNG" alt="1.1"></span></p>
</div>
<div class="paragraph">
<p>Exercise 1.2 Examine the schema of your database</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CALL db.schema()</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="image"><img src="resources/partOneExercise_1_2.PNG" alt="1.2"></span></p>
</div>
<div class="paragraph">
<p>Exercise 1.3 Retrive all Person nodes</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (p:Person)
RETURN p</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="image"><img src="resources/partOneExercise_1_3.PNG" alt="1.3"></span></p>
</div>
<div class="paragraph">
<p>Exercise 1.4 Retrive all Movie nodes</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (m:Movie)
RETURN m</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="image"><img src="resources/partOneExercise_1_4.PNG" alt="1.4"></span></p>
</div>
<hr>
</div>
</div>
<div class="sect3">
<h4 id="_part_two">Part two</h4>
<div class="sect4">
<h5 id="_properties">Properties</h5>
<div class="paragraph">
<p>In Neo4j a node can have properties that are used for further define a
node. A property is identified with a key and defined for a node and not
for a type of node. All nodes of the same type need not have the same
properties.</p>
</div>
<div class="paragraph">
<p>For example in the Movie graph all Movie nodes have both title and
released properties, however it is not requirement that every Movie node
has a property tagline:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="resources/taglineMovie.PNG" alt="taglineMovie"></span></p>
</div>
<div class="paragraph">
<p>Properties can be used to filter queries so that a subset of the graph
is retrived. In addition, with the <code>RETURN</code> clause, you can return
property values from the retrived nodes, rather than the nodes.</p>
</div>
<div class="paragraph">
<p>The propertiy keys of a graph can be view by execute
<code>CALL db.propertyKeys</code> which call the Neo4j library method that returns
the property keys for the graph. For example run this command in the
movie graph returns the result stream contains all property keys in the
graph:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="resources/propertyKeys.PNG" alt="propertyKeys"></span></p>
</div>
</div>
<div class="sect4">
<h5 id="_nodes_properties_filtering">Nodes properties filtering</h5>
<div class="paragraph">
<p><a href="https://www.youtube.com/watch?v=Nb9tSFVrQuc">youtube video - using match
to return propery values</a></p>
</div>
<div class="paragraph">
<p>It’s possible to filter the nodes of the graph to a specify a value for
a property, any node that matches the value will be retrived. Here some
examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (variable {propertyKey: propertyValue})
RETURN variable</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (variable:Label {propertyKey: propertyValue})
RETURN variable</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (variable:Label {propertyKey1: propertyValue1, propertyKey2: propertyValue2})
RETURN variable</code></pre>
</div>
</div>
<div class="paragraph">
<p>It’s possible to retrive a property values of nodes in a query and
return on output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (variable {property1: value})
RETURN variable.property2</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (variable:Label {property1: value})
RETURN variable.property2</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (variable:Label {property1: value, property2: value})
RETURN variable.property2, variable.property3</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the graph database we can filter the person born on 1970:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (p:Person {born: 1970})
RETURN p.name, p.born</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_aliases">Aliases</h5>
<div class="paragraph">
<p>To customize the headings for a table containing property value it can
be use aliases:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (variable:Label {property1: value, property2: value})
RETURN variable.property2 AS alias1, variable.property3 AS alias2</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the graph database we can specify aliases for the returned property
values:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (p:Person {born: 1970})
RETURN p.name AS name, p.born AS `birth year`</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_exercises_part_two">Exercises part two</h5>
<div class="paragraph">
<p><strong><em>on neof4j browser run the command <code>:play intro-neo4j-exercises</code> and
follow exercise 2 instructions</em></strong></p>
</div>
<div class="paragraph">
<p>First of all use the script found at
Cypher/exercises/part_one/createGraph.cql to create the basic graph:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">Added 171 labels, created 171 nodes, set 564 properties, created 253 relationships, completed after 24 ms.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 2.1: Retrieve all Movie nodes that have a released property
value of 2003.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (m:Movie {released: 2003})
RETURN m</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 2.2: View the retrieved results as a table.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (m:Movie {released: 2003})
RETURN m</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 2.3: Query the database for all property keys.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CALL db.propertyKeys</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 2.4: Retrieve all Movies released in a specific year, returning
their titles.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (m:Movie {released: 2006})
RETURN m.title</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 2.5: Display title, released, and tagline values for every
Movie node in the graph.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (m:Movie)
RETURN m.title, m.released, m.tagline</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 2.6: Display more user-friendly headers in the table.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (m:Movie)
RETURN m.title AS `Movie title`, m.released AS `Released date`, m.tagline AS `Tag line`</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect3">
<h4 id="_part_three">Part three</h4>
<div class="sect4">
<h5 id="_relationships">Relationships</h5>
<div class="paragraph">
<p>A relationship is a directed connection between two nodes that has a
relationship type (name). In addiction, a relationship can have
properties, just like nodes. In a match clause it’s possible to specify
nodes and their relationships to traverse the graph and quickly find the
data of interest:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>() // a node</code></p>
</li>
<li>
<p><code>()--() // 2 nodes have some type of relationship</code></p>
</li>
<li>
<p><code>()-&#8594;() // the first node has a relationship to the second node</code></p>
</li>
<li>
<p><code>()&#8592;-() // the second node has a relationship to the first node</code> The
relationship can be specified with or without direction.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here some examples for retrieving a set of nodes that satisfy one or
more directed and type relationships:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (node1)-[:REL_TYPE]-&gt;(node2)
RETURN node1, node2</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (node1)-[:REL_TYPEA | :REL_TYPEB]-&gt;(node2)
RETURN node1, node2</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">node1, node2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">is a specification of a node where you may include node
labels and property values for filtering</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">:REL_TYPE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">is the type for the relationship from node1 to node2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">:REL_TYPEA, :REL_TYPEB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">are the relationships from node1 to node2, the
nodes are returned if at least one of the relationships exists</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In the movie graph to retrive the nodes Person that have acted in the
Movie ``The Matrix'' we need to use relationships:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (node1:Person)-[relation:ACTED_IN]-&gt;(node2:Movie {title: "The Matrix"})
RETURN node1, relation, node2</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="image"><img src="resources/relationshipActorMatrix.PNG" alt="relationshipActorMatrix"></span></p>
</div>
<div class="paragraph">
<p>There is a build-in function <code>type()</code> that returns the relationship type
of a relationship. Here is an example where we use the rel variable to
hold the relationships retrived:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (p:Person)-[rel]-&gt;(:Movie {title: "The Matrix"})
RETURN p.name, type(rel)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output list will be: |p.name|type(rel)| |—|—| |<code>Hugo
Weaving''|</code>ACTED_IN''| |<code>Lilly Wachowski''|</code>DIRECTED''| |<code>Laurence
Fishburne''|</code>ACTED_IN''| |<code>Lana Wachowski''|</code>DIRECTED''| |<code>Keanu
Reeves''|</code>ACTED_IN''| |<code>Carrie-Anne Moss''|</code>ACTED_IN''| |<code>Joel
Silver''|</code>PRODUCED''| |<code>Emil Eifrem''|</code>ACTED_IN''|</p>
</div>
<div class="paragraph">
<p>Even relationships can have properties, this enables the graph model to
provide more data about the relationships between the nodes. Just as can
be specify property values for filtering nodes for a query, you can
specify property values for a relationships. Here is an example with the
movie graph:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">// Returns the name of the person who gave the movie "the da vinci code" a rating of 65
MATCH (p:Person)-[:REVIEWED {rating: 65}]-&gt;(:Movie {title: "The Da Vinci Code"})
RETURN p.name</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since relationships are directionals queries can have multiple type of
matching:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>right direction</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (n)-[r]-&gt;(m)
RETURN n, r, m</code></pre>
</div>
</div>
</li>
<li>
<p>left direction</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (n)&lt;-[r]-(m)
RETURN n, r, m</code></pre>
</div>
</div>
</li>
<li>
<p>both direction</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (n)-[r]-(m)
RETURN n, r, m</code></pre>
</div>
</div>
</li>
<li>
<p>traversing relationships</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (n)-[r]-&gt;(m)-[p]-&gt;(o)
RETURN n, m, o</code></pre>
</div>
</div>
<div class="paragraph">
<p>with query like this it can be usefull to assign a variable to the path
and return the path:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH path = (n)-[r]-&gt;(m)-[p]-&gt;(o)
RETURN path</code></pre>
</div>
</div>
</li>
<li>
<p>Centralising relationships</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (n)-[r]-&gt;(m)&lt;-[p]-(o)
RETURN n, m, o</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_style_recommendations">Style recommendations</h5>
<div class="ulist">
<ul>
<li>
<p>Node labels are CamelCase and begin with an upper-case letter, like
Person or NetworkAddress.</p>
</li>
<li>
<p>Property keys, variables, parameters, aliases, and functions are
camelCase and begin with a lower-case letter, like title or
businessAddress.</p>
</li>
<li>
<p>Relationship type are in upper-case and can use the underscore, like
ACTED_IN or FOLLOWS.</p>
</li>
<li>
<p>Cypher keywords are upper-case, like MATCH or RETURN.</p>
</li>
<li>
<p>String constats are in single quotes, unless the string contains a
quote or apostrophe, like `The Matrix' or ``Something’s Gotta Give''.</p>
</li>
<li>
<p>Specify variables only when needed for use later in the cypher
statement.</p>
</li>
<li>
<p>Place named nodes and relationships before anonymous nodes and
relationships in the MATCH clauses when possible.</p>
</li>
<li>
<p>Specify anonymous relationships with <code>-&#8594;</code>, <code>--</code>, or <code>&#8592;-</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_exercises_part_three">Exercises part three</h5>
<div class="paragraph">
<p><strong><em>on neof4j browser run the command <code>:play intro-neo4j-exercises</code> and
follow exercise 3 instructions</em></strong></p>
</div>
<div class="paragraph">
<p>First of all use the script found at
Cypher/exercises/part_one/createGraph.cql to create the basic graph:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">Added 171 labels, created 171 nodes, set 564 properties, created 253 relationships, completed after 24 ms.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 3.1: Display the schema of the database.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CALL db.schema</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 3.2: Retrieve all people who wrote the movie Speed Racer.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (p:Person)-[:WROTE]-&gt;(:Movie {title: "Speed Racer"})
RETURN p</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 3.3: Retrieve all movies that are connected to the person, Tom
Hanks.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (m:Movie)--(:Person {name: 'Tom Hanks'})
RETURN m</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 3.4: Retrieve information about the relationships Tom Hanks had
with the set of movies retrieved earlier.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (m:Movie)-[relation]-(:Person {name: 'Tom Hanks'})
RETURN m.title, type(relation)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 3.5: Retrieve information about the roles that Tom Hanks acted
in</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (m:Movie)-[acted:ACTED_IN]-(:Person {name: 'Tom Hanks'})
RETURN m.title, acted.roles</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect3">
<h4 id="_part_four">Part four</h4>
<div class="sect4">
<h5 id="_where">Where</h5>
<div class="paragraph">
<p><strong><em>on neof4j browser run the command `:help WHERE`</em></strong></p>
</div>
<div class="paragraph">
<p>The most common clause to filter queries is <code>WHERE</code> that follows a
<code>MATCH</code> clause. This clause is the answer for <code>`how we filter the result
for a particular match'', so this filter all of the nodes and
relationships. In the `WHERE</code> clause it is possible to place conditions
that are evaluated at runtime to filter the query. The potential of this
clause is that is possible to specify complex conditions for the query.</p>
</div>
<div class="paragraph">
<p>Some examples:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Example 1</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (m:Movie)
WHERE m.title = "The Matrix"
RETURN m</code></pre>
</div>
</div>
</li>
<li>
<p>Example 2</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (p:Person)-[:ACTED_IN]-&gt;(m:Movie)
WHERE m.released = 2008
RETURN p, m</code></pre>
</div>
</div>
</li>
<li>
<p>Example 3</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (p:Person)-[:ACTED_IN]-&gt;(m:Movie)
WHERE m.released = 2008 OR m.released = 2009
RETURN p, m</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>This clause accept conditions that return a boolean value of true or
false. It can be use several comparison operators: <strong>=</strong>, <strong>&lt;&gt;</strong>, <strong>&lt;</strong>, <strong>&gt;</strong>,
<strong>&#8656;</strong>, <strong>&gt;=</strong>, <strong>IS NULL</strong>, <strong>IS NOT NULL</strong>, <strong>=~</strong>. There are 4 boolean
operators that it can use: <strong>AND</strong>, <strong>OR</strong>, <strong>XOR</strong>, <strong>NOT</strong>.</p>
</div>
<div class="paragraph">
<p>An example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (p:Person)-[r:ACTED_IN]-&gt;(m:Movie)
WHERE
    m.released &gt; 2000 OR
    (1994 &lt; m.released &lt;= 1997 AND m.title='As Good as It Gets')
RETURN p.name, m.title, m.released</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is opssible to filter node labels in the WHERE clause, for example
this two queries:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (p:Person)
RETURN p.name</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (p:Person)-[:ACTED_IN]-&gt;(:Movie {title: 'The Matrix'})
RETURN p.name</code></pre>
</div>
</div>
<div class="paragraph">
<p>can be rewritten usign WHERE clauses:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (p)
WHERE p:Person
RETURN p.name</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (p)-[:ACTED_IN]-&gt;(m)
WHERE p:Person AND m:Movie AND m.title = 'The Matrix'
RETURN p.name</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since we are talking about graph database not all the nodes with the
same label have the same properties, with the WHERE clause and the
build-in function <code>exists(property)</code> we can filter the nodes that
doesn’t have value for the property requested. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (p:Person)-[:ACTED_IN]-&gt;(m:Movie)
WHERE p.name='Jack Nicholson' AND exists(m.tagline)
RETURN m.title, m.tagline</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are also a set of string-related keywords to test string property
values: <code>STARTS WITH</code>, <code>ENDS WITH</code>, and <code>CONTAINS</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (p:Person)-[:ACTED_IN]-&gt;()
WHERE p.name STARTS WITH 'Michael'
RETURN p.name</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#regular-expression">Regular expressions</a> can be used to test
property values, to specify the request it’s necessary to use the <strong>=~</strong>
in the condition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (p:Person)
WHERE p.name =~'Tom.*'
RETURN p.name</code></pre>
</div>
</div>
<div class="paragraph">
<p>The query above retrive all Person nodes with a name property that
begins with Tom, the result can be something like this:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">p.name</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``Tom Cruise''</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``Tom Hanks''</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``Tom Skerritt''</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``Tom Tykwer''</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Some more filtering for relationships can be used during a query, for
example can be possible to use the <code>NOT</code> in a <code>WHERE</code> clause:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (p:Person)-[:WROTE]-&gt;(m:Movie)
WHERE NOT exists( (p)-[:DIRECTED]-&gt;() )
RETURN p.name, m.title</code></pre>
</div>
</div>
<div class="paragraph">
<p>This query exclude Person who directed and not wrote the movie.</p>
</div>
<div class="paragraph">
<p>One more filtering is <code>IN</code> that can be used to compare each property
with values on the list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (p:Person)
WHERE p.born IN [1965, 1970]
RETURN p.name as name, p.born as yearBorn</code></pre>
</div>
</div>
<div class="paragraph">
<p>and the return is:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">yearBorn</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``Lana Wachowsky''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1965</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``Jay Mohr''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1970</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``River Phoenix''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1970</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``Brooke Langton''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1970</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_exercises_part_four">Exercises part four</h5>
<div class="paragraph">
<p><strong><em>on neof4j browser run the command <code>:play intro-neo4j-exercises</code> and
follow exercise 4 instructions</em></strong></p>
</div>
<div class="paragraph">
<p>First of all use the script found at
Cypher/exercises/part_one/createGraph.cql to create the basic graph:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">Added 171 labels, created 171 nodes, set 564 properties, created 253 relationships, completed after 24 ms.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 4.1: Retrieve all movies that Tom Cruise acted in.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (tom:Person {name: 'Tom Cruise'})-[:ACTED_IN]-(movie:Movie)
RETURN movie.title</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (tom:Person)-[:ACTED_IN]-(movie:Movie)
WHERE tom.name = 'Tom Cruise'
RETURN movie.title</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 4.2: Retrieve all actors that were born in the 70’s, return
name and year born.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (p:Person)-[:ACTED_IN]-&gt;(:Movie)
WHERE 1970 &lt;= p.born &lt;= 1979
RETURN p.name AS Name, p.born AS `Year Born`</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 4.3: Retrieve the actors who acted in the movie The Matrix who
were born after 1960, return name and year born.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (act:Person)-[:ACTED_IN]-&gt;(m:Movie)
WHERE m.title = 'The Matrix' AND act.born &gt; 1960
RETURN act.name as Name, act.born as `Year Born`</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 4.4: Retrieve all movies released in 2000 by testing the node
label and released property, return the title of the movie.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (mov:Movie)
WHERE mov.released = 2000
RETURN mov.title</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 4.5: Retrieve all people that wrote movies by testing the
relationship between two nodes, return the name of the people and the
title of the movie.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (p)-[rel]-&gt;(mov)
WHERE p:Person AND type(rel) ='WROTE' AND mov:Movie
RETURN p.name AS Name, mov.title AS `Movie title`</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 4.6: Retrieve all people in the graph that do not have a the
born property and return there name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (p)
WHERE p:Person AND NOT exists(p.born)
RETURN p.name AS Name</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 4.7: Retrieve all people related to movies where the
relationship has the rating property, than return their name, movie,
title and the rating.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (p:Person)-[rel]-(m:Movie)
WHERE exists(rel.rating)
RETURN
    p.name AS Name,
    m.title AS `Movie title`,
    rel.rating AS Rating</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 4.8: Retrieve all actors whose name begins with James.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (p:Person)
WHERE p.name =~'James.*'
RETURN p.name</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (p:Person)
WHERE p.name STARTS WITH 'James'
RETURN p.name</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 4.9: Retrieve all all REVIEW relationships from the graph with
filtered results.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH ()-[rel:REVIEWED]-&gt;(movie:Movie)
WHERE toLower(rel.summary) CONTAINS 'fun'
RETURN
    movie.title as `Movie Title`,
    rel.rating as `Rating`,
    rel.summary as `Summary`</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 4.10: Retrieve all people who have produced a movie, but have
not directed a movie.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (a:Person)-[:PRODUCED]-&gt;(m:Movie)
WHERE NOT ((a)-[:DIRECTED]-&gt;(:Movie))
RETURN a.name, m.title</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 4.11: Retrieve the movies and their actors where one of the
actors also directed the movie.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (actor:Person)-[:ACTED_IN]-&gt;(mov:Movie)&lt;-[:DIRECTED]-(dir:Person)
WHERE (dir)-[:ACTED_IN]-&gt;(mov)
RETURN actor.name, dir.name, mov.title</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 4.12: Retrieve all movies that were released in a set of years.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (m)
WHERE
    m:Movie AND
    m.released IN [2004, 2008, 2000]
RETURN m.title, m.released</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 4.13: Retrieve the movies that have an actor’s role that is the
name of the movie.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (act:Person)-[rel:ACTED_IN]-&gt;(mov:Movie)
WHERE mov.title in rel.roles
RETURN mov.title, rel.roles</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect3">
<h4 id="_part_five">Part five</h4>
<div class="sect4">
<h5 id="_multiple_match_patterns">Multiple Match patterns</h5>
<div class="paragraph">
<p>The <code>MATCH</code> clause includes a pattern specified by two paths separated
by a comma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (a:Person)-[:ACTED_IN]-&gt;(m:Movie),
    (m:Movie)&lt;-[:DIRECTED]-(d:Person)
WHERE m.released = 2000
RETURN a.name, m.title, d.name</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_setting_path_variables">Setting path variables</h5>
<div class="paragraph">
<p>It’s possible to assign to a variable a path that can be reuse later in
the same query or if it’s needed to return that path:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH megPath = (meg:Person)-[:ACTED_IN]-&gt;(m:Movie)&lt;-[:DIRECTED]-(d:Person),
    (other:Person)-[:ACTED_IN]-&gt;(m)
WHERE meg.name = 'Meg Ryan'
RETURN megPath</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_varying_lenght_paths">Varying lenght paths</h5>
<div class="paragraph">
<p>Any graph that represents social networking, trees, or hierarchies will
most likely have multiple paths of varying lengths.</p>
</div>
<div class="paragraph">
<p>To get this far you need to use this format
<code>(nodeA)-[:REALTYPE*&lt;number_of_hops&gt;]&#8594;(nodeB)</code> or
<code>(nodeA)-[:REALTYPE*n..m]&#8594;(nodeB)</code> where n and m are the extremes of an
interval.</p>
</div>
</div>
<div class="sect4">
<h5 id="_finding_the_shortest_path">Finding the shortest path</h5>
<div class="paragraph">
<p>A built-in function that you may find useful in a graph that has many
ways of traversing the graph to get to the same node is the
<code>shortestPath()</code> function. Using the shortest path between two nodes
improves the performance of the query.</p>
</div>
<div class="paragraph">
<p>Here an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH p = shortestPath((m1:Movie)-[*]-(m2:Movie))
WHERE m1.title = 'A Few Good Men' AND
    m2.title = 'The Matrix'
RETURN p</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you use the shortestPath() function, the query editor will show a
warning that this type of query could potentially run for a long time.
You should heed the warning, especially for large graphs. Read the Graph
Algorithms documentation about the shortest path algorithm.</p>
</div>
<div class="paragraph">
<p>When you use ShortestPath(), you can specify a upper limits for the
shortest path. In addition, you should aim to provide the patterns for
the from an to nodes that execute efficiently. For example, use labels
and indexes.</p>
</div>
</div>
<div class="sect4">
<h5 id="_optional_pattern_matching">Optional pattern matching</h5>
<div class="paragraph">
<p>This clause <code>OPTIONAL MATCH</code> is just like the <code>MATCH</code> but if no matches
are found, this clause will use null for missing parts of the pattern.
Here is an examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (p:Person)
WHERE p.name STARTS WITH 'James'
OPTIONAL MATCH (p)-[r:REVIEWED]-&gt;(m:Movie)
RETURN p.name, type(r), m.title</code></pre>
</div>
</div>
<div class="paragraph">
<p>The return will be a table like this:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">p.name</th>
<th class="tableblock halign-left valign-top">type(r)</th>
<th class="tableblock halign-left valign-top">m.title</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``James Marshall''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``James L. Brooks''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``James Cromwell''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``James Thompson''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``REVIEWED''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``The Replacements''</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``James Thompson''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``REVIEWED''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``The Da Vinci Code''</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_aggregation_in_cypher">Aggregation in Cypher</h5>
<div class="paragraph">
<p>In Cypher is not need to specify a grouping key, all non-aggregated
result columns become grouping keys, The grouping is implicity done
beased upon the filds in the <code>RETURN</code> clause.</p>
</div>
<div class="paragraph">
<p>For example, in Cypher statement, all rows returned with the same values
for a.name and d.name are counted and only return once:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (a)-[:ACTED_IN]-&gt;(m)&lt;-[:DIRECTED]-(d)
RETURN a.name, d.name, count(*)</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">a.name</th>
<th class="tableblock halign-left valign-top">d.name</th>
<th class="tableblock halign-left valign-top">count(*)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``Emil Eifrem''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``Lana Wachowski''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``Hugo Weaving''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``Lana Wachowski''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``Laurence Fishburne''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``Lana Wachowski''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``Carrie-Anne Moss''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``Lana Wachowski''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``Keanu Reeves''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``Lana Wachowski''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``Emil Eifrem''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``Lilly Wachowski''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``Hugo Weaving''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``Lilly Wachowski''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``Laurence Fishburne''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``Lilly Wachowski''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``Carrie-Anne Moss''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``Lilly Wachowski''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``Keanu Reeves''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``Lilly Wachowski''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``Al Pacino''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``Taylor Hackford''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This function is very useful when you want to count the number of
occurrences of a particular query result. It’s possible to specify the
occurrences of an alias <code>count(n)</code> and the graph engine calculates the
number of occurrences of n. If we want to calculates the number of rows
retrived, including those with <code>null</code> values the count argument need to
be a *. Last one is the <code>count()</code> without argument and this will
implicit group by based upon the aggregation.</p>
</div>
<div class="paragraph">
<p>There are more aggregating functions such as <code>min()</code> or <code>max()</code> that can
also use in queries.</p>
</div>
</div>
<div class="sect4">
<h5 id="_collecting_results">Collecting results</h5>
<div class="paragraph">
<p>Cypher has a built-in function <code>collect()</code> that enables you to aggregate
value into a list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (p:Person)-[:ACTED_IN]-&gt;(m:Movie)
WHERE p.name = 'Tom Cruise'
RETURN collect(m.title) AS `movies for Tom Cruise`</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the result will be a list called <strong>movies for Tom Cruise</strong> with the
values [<code>Jerry Maguire'', </code>Top Gun'', ``A Few Good Men''].</p>
</div>
</div>
<div class="sect4">
<h5 id="_additional_processing_using_with">Additional processing using <code>WITH</code></h5>
<div class="paragraph">
<p>During the execution of a <code>MATCH</code> clause, is possible to specify some
intermediate calculations or values that will be used for further
processing of the query, or for limiting the number of results before
further processing is done. With the <code>WITH</code> clause it’s possible to
perform intermediate processing ro data flow operations.</p>
</div>
<div class="paragraph">
<p>Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (a:Person)-[:ACTED_IN]-&gt;(m:Movie)
WITH a, count(a) AS numMovies, collect(m.title) AS movies
WHERE numMovies &gt; 1 AND numMovies &lt; 4
RETURN a.name, numMovies, movies</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example return the actors name only if they acted on 2 or 3 movies,
with a reference of the numbers of the films and a list of that.</p>
</div>
<div class="paragraph">
<p>Be carefull with this clause because in the <code>WITH</code> body are specify some
variables from the previous part of the query that need to be part of
the next section of the query, all the aliases for the next part are the
only one defined in the body.</p>
</div>
<div class="paragraph">
<p>Remember to name all expressions with an alias in a <code>WITH</code> that are not
simple variables.</p>
</div>
<div class="paragraph">
<p>One more example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (p:Person)
WITH p, size((p)-[:ACTED_IN]-&gt;(:Movie)) as movies
WHERE movies&gt;=5
OPTIONAL MATCH (p)-[:DIRECTED]-&gt;(m:Movie)
RETURN p.name, m.title</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a simple query to retrive all the actor that are acted in at
least 5 movies and if they also directed a movie than return the name of
that movie.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">p.name</th>
<th class="tableblock halign-left valign-top">m.title</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``Keanu Reeves''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``Hugo Weaving''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``Jack Nicholson''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``Meg Ryan''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``Tom Hanks''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``That Thing You Do''</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_exercises_part_five">Exercises part five</h5>
<div class="paragraph">
<p><strong><em>on neof4j browser run the command <code>:play intro-neo4j-exercises</code> and
follow exercise 5 instructions</em></strong></p>
</div>
<div class="paragraph">
<p>First of all use the script found at
Cypher/exercises/part_one/createGraph.cql to create the basic graph:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">Added 171 labels, created 171 nodes, set 564 properties, created 253 relationships, completed after 24 ms.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 5.1: Write a Cypher query that retrieves all movies that Gene
Hackman has acted it, along with the directors of the movies. In
addition, retrieve the actors that acted in the same movies as Gene
Hackman. Return the name of the movie, the name of the director, and the
names of actors that worked with Gene Hackman.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (gene:Person)-[:ACTED_IN]-&gt;(movie:Movie)
WHERE gene.name = 'Gene Hackman'
OPTIONAL MATCH
    (other:Person)-[:ACTED_IN]-&gt;(movie),
    (dir:Person)-[:DIRECTED]-&gt;(movie)
WITH
    movie,
    collect(other.name) AS Actors,
    collect(dir.name) AS Directors
RETURN
    movie.title AS `Title of movie`,
    Actors AS `Co-Actors`,
    Directors</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 5.2: Retrieve all nodes that the person named James Thompson
directly has the FOLLOWS relationship in either direction.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (james:Person)-[:FOLLOWS]-(other:Person)
WHERE james.name = 'James Thompson'
RETURN james, other</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 5.3: Modify the query to retrieve nodes that are exactly three
hops away.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (james:Person)-[:FOLLOWS*3]-(other:Person)
WHERE james.name = 'James Thompson'
RETURN james, other</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 5.4: Modify the query to retrieve nodes that are one and two
hops away.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (james:Person)-[:FOLLOWS*1..2]-(other:Person)
WHERE james.name = 'James Thompson'
RETURN james, other</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 5.5: Modify the query to retrieve particular nodes that are
connected no matter how many hops are required.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (james:Person)-[:FOLLOWS*]-(other:Person)
WHERE james.name = 'James Thompson'
RETURN james, other</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 5.6: Write a Cypher query to retrieve all people in the graph
whose name begins with Tom and optionally retrieve all people named Tom
who directed a movie.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (tom:Person)
WHERE toLower(tom.name) STARTS WITH 'tom'
OPTIONAL MATCH (tom)-[:DIRECTED]-&gt;(movie:Movie)
WITH tom, collect(movie.title) as DirMov
RETURN tom.name AS `Tom* name`, DirMov AS `Directed movies`</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 5.7: Retrieve actors and the movies they have acted in,
returning each actor’s name and the list of movies they acted in.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (actor:Person)-[:ACTED_IN]-&gt;(movie:Movie)
WITH actor.name AS Actor, collect(movie.title) as Movies
RETURN Actor, Movies</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 5.8: Retrieve all movies that Tom Cruise has acted in and the
co-actors that acted in the same movie, returning the movie title and
the list of co-actors that Tom Cruise worked with.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (tom:Person {name: "Tom Cruise"})-[:ACTED_IN]-&gt;(movie:Movie)&lt;-[:ACTED_IN]-(other:Person)
RETURN movie.title AS `Movie`, collect(other.name) AS `Co-Actors`</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 5.9: Retrieve all people who reviewed a movie, returning the
list of reviewers and how many reviewers reviewed the movie.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (reviewer:Person)-[:REVIEWED]-&gt;(movie:Movie)
RETURN movie.title AS `Movie`, collect(reviewer.name) AS `reviewers`, count(reviewer) as `Number of reviewers`</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 5.10: Retrieve all directors, their movies, and people who
acted in the movies, returning the name of the director, the number of
actors the director has worked with, and the list of actors.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (dir:Person)-[:DIRECTED]-&gt;(movie:Movie)&lt;-[:ACTED_IN]-(actor:Person)
WITH dir.name as Director, count(actor) as ActorsNumber, collect(actor.name) AS ActorsList
RETURN Director, ActorsList AS `Actors` , ActorsNumber AS `Number of actors`</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 5.11: Retrieve the actors who have acted in exactly five
movies.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (actor:Person)-[:ACTED_IN]-&gt;(movie:Movie)
WITH actor, count(movie) as movies, collect(movie.title) as moviesList
WHERE movies = 5
RETURN actor.name AS `Name of actor`, moviesList as `Movies`</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 5.12: Retrieve the movies that have at least 2 directors, and
optionally the names of people who reviewed the movies.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (dir:Person)-[:DIRECTED]-&gt;(movie:Movie)
WITH movie, count(dir) AS numDir
WHERE numDir &gt;= 2
OPTIONAL MATCH (movie)&lt;-[:REVIEWED]-(reviewer:Person)
WITH movie.title AS title, collect(reviewer.name) as listRev
RETURN title, listRev AS `reviewer`</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect3">
<h4 id="_part_six">Part six</h4>
<div class="sect4">
<h5 id="_eliminating_duplication">Eliminating duplication</h5>
<div class="paragraph">
<p>To eliminating duplicated results it can be used the <code>DISTINCT</code> keyword</p>
</div>
<div class="paragraph">
<p>This is the exercise 5.1, we can use the DISTINCT clause to avoid
repeting the directors in the list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (gene:Person)-[:ACTED_IN]-&gt;(movie:Movie)
WHERE gene.name = 'Gene Hackman'
OPTIONAL MATCH
    (other:Person)-[:ACTED_IN]-&gt;(movie),
    (dir:Person)-[:DIRECTED]-&gt;(movie)
WITH
    movie,
    collect(other.name) AS Actors,
    collect(DISTINCT dir.name) AS Directors
RETURN
    movie.title AS `Title of movie`,
    Actors AS `Co-Actors`,
    Directors</code></pre>
</div>
</div>
<div class="paragraph">
<p>This clause can be use in several uses, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (p:Person)-[:DIRECTED | :ACTED_IN]-&gt;(m:Movie)
WHERE p.name = 'Tom Hanks'
WITH DISTINCT m
RETURN m.released, m.title</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ordering_result">Ordering result</h5>
<div class="paragraph">
<p>If you want the results to be sorted, you specify the expression to use
for the sort usign the <code>ORDER BY</code> keyword and whether you want the order
to be descending using the <code>DESC</code> keyword. Ascending order is the
default. It can be use multiple sort expressions and the result will be
sorted in that order.</p>
</div>
<div class="paragraph">
<p>This is an example where there is a specification for the release date
of the movies for Tom Hanks:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (p:Person)-[:DIRECTED | :ACTED_IN]-&gt;(m:Movie)
WHERE p.name = 'Tom Hanks' AND m.released &gt;= 2000
RETURN m.released, collect(DISTINCT m.title) AS movies ORDER BY m.released DESC</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">m.released</th>
<th class="tableblock halign-left valign-top">movies</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[``Cloud Atlas'']</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2007</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[``Charlie Wilson’s War'']</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2006</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[``The Da Vinci Code'']</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2004</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[``The Polar Express'']</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[``Cast Away'']</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_limiting_the_number_of_results">Limiting the number of results</h5>
<div class="paragraph">
<p>Although you can filter queries to reduce the number of results
returned, you may also want to limit the number of results. This is
useful if you have very large result sets and you only need to see the
beginning or end of a set of ordered results. <code>LIMIT</code> is the right
choice to do something like this.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (m:Movie)
RETURN m.title as title, m.released as year
ORDER BY m.released DESC
LIMIT 10</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_exercises_part_six">Exercises part six</h5>
<div class="paragraph">
<p><strong><em>on neof4j browser run the command <code>:play intro-neo4j-exercises</code> and
follow exercise 6 instructions</em></strong></p>
</div>
<div class="paragraph">
<p>First of all use the script found at
Cypher/exercises/part_one/createGraph.cql to create the basic graph:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">Added 171 labels, created 171 nodes, set 564 properties, created 253 relationships, completed after 24 ms.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 6.1: You want to know what actors acted in movies in the decade
starting with the year 1990. First write a query to retrieve all actors
that acted in movies during the 1990s, where you return the released
date, the movie title, and the collected actor names for the movie. For
now do not worry about duplication.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (per:Person)-[:ACTED_IN]-&gt;(mov:Movie)
WHERE 1990 &lt;= mov.released &lt; 2000
RETURN mov.released, mov.title, collect(per.name)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 6.2: Modify the query to eliminate duplication.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (per:Person)-[:ACTED_IN]-&gt;(mov:Movie)
WHERE 1990 &lt;= mov.released &lt; 2000
RETURN mov.released, collect(mov.title), collect(per.name)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 6.3: Modify the query to eliminate more duplication.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (per:Person)-[:ACTED_IN]-&gt;(mov:Movie)
WHERE 1990 &lt;= mov.released &lt; 2000
RETURN mov.released, collect(DISTINCT mov.title), collect(DISTINCT per.name)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 6.4: Sort results returned.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (per:Person)-[:ACTED_IN]-&gt;(mov:Movie)
WHERE 1990 &lt;= mov.released &lt; 2000
RETURN mov.released, collect(DISTINCT mov.title), collect(DISTINCT per.name)
ORDERED BY mov.released DESC</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 6.5: Retrieve the top 5 ratings and their associated movies.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (:Person)-[rel:REVIEWED]-&gt;(mov:Movie)
RETURN mov.title, rel.rating as rat
ORDER BY rat DESC
LIMIT 5</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 6.6: Retrieve all actors that have not appeared in more than 3
movies.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (act:Person)-[:ACTED_IN]-&gt;(mov:Movie)
WITH act, count(mov) AS numberMovies, collect(mov.title) AS movies
where numberMovies &lt;= 3
RETURN act.name, movies</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect3">
<h4 id="_part_seven">Part Seven</h4>
<div class="sect4">
<h5 id="_list">List</h5>
<div class="paragraph">
<p>There are many build-in Cypher functions that you can use to build or
access elements in lists. A Cypher <code>map</code> is list of key/value pairs
where each element of the list is of the format key: value.</p>
</div>
<div class="paragraph">
<p>It’s possible to collect values for a list during a query and with this
it’s possible to sort by the size of the list using the <code>size()</code>
function as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (a:Person)-[:ACTED_IN]-&gt;(m:Movie)
WITH m, count(m) AS numCast, collect(a.name) AS cast
RETURN m.title, cast, numCast
ORDER BY size(cast)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_unwinding_lists">Unwinding lists</h5>
<div class="paragraph">
<p>There my be some situations where you want to perform the opposite of
collecting results, but rather separate the lists into separate rows.
This functionality is done using the unwind clause.</p>
</div>
<div class="paragraph">
<p>Here is an example where we create a list with three elements, unwind
the list and then return the values. Since there are three elements,
three rows are returned with the values:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">WITH [1, 2, 3] AS list
UNWIND list AS row
RETURN row, list</code></pre>
</div>
</div>
<div class="paragraph">
<p>and the result will be:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">row</th>
<th class="tableblock halign-left valign-top">list</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[1,2,3]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[1,2,3]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[1,2,3]</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>unwind</code> clause is frequently used when importing data into a graph.</p>
</div>
</div>
<div class="sect4">
<h5 id="_dates">Dates</h5>
<div class="paragraph">
<p>Cypher has a built-in <code>date()</code> function, as well as other temporal
values and functions that you can use to calculate temporal values. You
use a combination of numeric, temporal, spatial, list and string
functions to calculate values that are useful to your application.</p>
</div>
<div class="paragraph">
<p>For example we want to calculate all the age value of the actors given
the born year:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (actor:Person)-[:ACTED_IN]-&gt;(:Movie)
WHERE exists(actor.born)
WITH DISTINCT actor, date().year - actor.born AS age
RETURN actor.name, age AS `age today`
ORDER BY actor.born DESC</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_exercises_part_seven">Exercises part seven</h5>
<div class="paragraph">
<p><strong><em>on neof4j browser run the command <code>:play intro-neo4j-exercises</code> and
follow exercise 7 instructions</em></strong></p>
</div>
<div class="paragraph">
<p>First of all use the script found at
Cypher/exercises/part_one/createGraph.cql to create the basic graph:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">Added 171 labels, created 171 nodes, set 564 properties, created 253 relationships, completed after 24 ms.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 7.1: Write a Cypher query that retrieves all actors that acted
in movies, and also retrieves the producers for those movies. During the
query, collect the names of the actors and the names of the producers.
Return the movie titles, along with the list of actors for each movie,
and the list of producers for each movie making sure there is no
duplication of data. Order the results returned based upon the size of
the list of actors.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (act:Person)-[:ACTED_IN]-&gt;(mov:Movie)&lt;-[:PRODUCED]-(prod:Person)
WITH mov, collect(act.name) AS actList, collect(DISTINCT prod.name) AS prodList
RETURN mov.title AS `Title`, actList AS `Actors`, prodList AS `Producers`
ORDER BY size(actList) DESC</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 7.2: Write a Cypher query that retrieves all actors that acted
in movies, and collects the list of movies for any actor that acted in
more than five movies. Return the name of the actor and the list.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (act:Person)-[:ACTED_IN]-&gt;(mov:Movie)
WITH act, collect(mov.title) as movs
WHERE size(movs) &gt; 5
RETURN act.name AS `Name`, movs AS `Movies`</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 7.3: Modify the query you just wrote so that before the query
processing ends, you unwind the list of movies and then return the name
of the actor and the title of the associated movie</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (act:Person)-[:ACTED_IN]-&gt;(mov:Movie)
WITH act, collect(mov.title) as movs
WHERE size(movs) &gt; 5
UNWIND movs as movie
RETURN act.name, movie</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 7.4: Write a query that retrieves all movies that Tom Hanks
acted in, returning the title of the movie, the year the movie was
released, the number of years ago that the movie was released, and the
age of Tom when the movie was released.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (tom:Person)-[:ACTED_IN]-&gt;(mov:Movie)
WHERE tom.name = "Tom Hanks"
WITH mov, date().year - mov.released AS yearsAgo, mov.released - tom.born AS yearTom
RETURN mov.title, mov.released, yearsAgo, yearTom
ORDER BY yearsAgo</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect3">
<h4 id="_part_eight">Part Eight</h4>
<div class="sect4">
<h5 id="_create">Create</h5>
<div class="paragraph">
<p><strong><em>on neof4j browser run the command `:help CREATE`</em></strong></p>
</div>
<div class="paragraph">
<p>Recall that a node is an element of a graph representing a domain entity
that has zero or more labels, properties, and relationships to or from
other nodes in the graph.</p>
</div>
<div class="paragraph">
<p>When you create a node, you can add it to the graph without connecting
it to another node.</p>
</div>
<div class="paragraph">
<p>Here is the simplified syntax for creating a node:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CREATE (optionalVariable optionalLabels {optionalProperties})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let’s create a small social graph using this query language.</p>
</div>
<div class="paragraph">
<p>If you plan on referencing the newly created node, you must provide a
variable. Whether you provide labels or properties at node creation time
is optional. In most cases, you will want to provide some label and
property values for a node when created. This will enable you to later
retrive the node. Provided you have a reference to the node.</p>
</div>
<div class="paragraph">
<p>Here some examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>1 &#8594; Create node of type <em>Movie</em> with the <em>title Batman Begins</em>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CREATE  (:Movie {title: 'Batman Begins'})</code></pre>
</div>
</div>
</li>
<li>
<p>2 &#8594; Create a node with two labels to the graph of types <em>Movie</em> and
<em>Action</em> with the <em>title Batman Begins</em>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CREATE (:Movie:Action {title: 'Batman Begins'})</code></pre>
</div>
</div>
</li>
<li>
<p>3 &#8594; Create the same node of example 2 and return the title:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CREATE (m:Movie:Action {title: 'Batman Begins'})
RETURN m.title</code></pre>
</div>
</div>
</li>
<li>
<p>4 &#8594; Create the same node but with more properties:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CREATE (:Movie:Action {title: 'Batman Begins', released: 2005})</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>When the graph engine creates a node, it automatically assigns a
read-only, unique ID to the node but this value is not accessible like
the other properties but is an internal value.</p>
</div>
<div class="paragraph">
<p>If all of this 4 queries are execute, this will generate 4 differents
nodes this is because the graph engine will create a node with the same
properties of a node that already exists. To prevent this ``<em>issue</em>''
you can use the <strong>MERGE</strong> clause rather than <strong>CREATE</strong> or you can add
constraints to the graph.</p>
</div>
</div>
<div class="sect4">
<h5 id="_more_create_at_once">More create at once</h5>
<div class="paragraph">
<p><strong>Create</strong> clauses can create many nodes at once:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CREATE
(:Person {name: 'Michael Caine', born: 1933}),
(:Person {name: 'Liam Neeson', born: 1952})

CREATE
(:Person {name: 'Katie Holmes', born: 1978}),
(:Person {name: 'Benjamin Melniker', born: 1913})</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are two ways to create multiple nodes at once: by separating the
nodes specified with commas, or by specifying multiple CREATE
statements.</p>
</div>
</div>
<div class="sect4">
<h5 id="_add_and_remove_the_labels">Add and remove the labels</h5>
<div class="paragraph">
<p><strong><em>on neof4j browser run the command `:help SET`</em></strong></p>
</div>
<div class="paragraph">
<p>Obviously it can be added more lable or lables for a node before it’s
creations using the <strong>SET</strong> clause.</p>
</div>
<div class="paragraph">
<p>Adding 1 label to the x node:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">SET x:Label</code></pre>
</div>
</div>
<div class="paragraph">
<p>Adding 2 labels to the x node:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">SET x:Label1:Label2</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>SET</strong> processing is ignored if that label already exists in that
node.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (m:Movie)
WHERE m.title = 'Batman Begins`
SET m:Action
RETURN labels(m)</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>This query used the build-in function <code>label()</code> that return the set of
labels for the node</em></p>
</div>
<div class="paragraph">
<p>It’s possible to remove labels from a node by using the <strong>REMOVE</strong> clause
with the same syntax of the <strong>SET</strong> clause.</p>
</div>
<div class="paragraph">
<p>Example: Remove the Action label from the previous created node.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (m:Movie:Action)
WHERE m.title = 'Batman Begins'
REMOVE m:Action
RETURN labels(m)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_adding_properties_to_a_node">Adding properties to a node</h5>
<div class="paragraph">
<p>The <strong>SET</strong> clause can be use even to add properties to a node.</p>
</div>
<div class="paragraph">
<p>Some examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">SET x.propertyName = value</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">SET x.propertyName1 = value1, x.propertyName2 = value2</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">SET x = {propertyName1: value1, propertyName2: value2}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">SET x += {propertyName1: value1, propertyName2: value2}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the property does not exist, it is added to the node. If the property
exists, its value is updated. If the value specified is <code>null</code>, the
property is removed.</p>
</div>
<div class="paragraph">
<p>The type of data for a property is not enforced, so you can assign a
string value to a property that was once a numeric value and visa versa.</p>
</div>
<div class="paragraph">
<p>When the assignment used is the <code>=</code> than the properties and their values
must exists and their values are overwritten; however <code>+=</code> is used to
update if exists already, alternatively the properties and values are
created.</p>
</div>
<div class="paragraph">
<p>Example: Add the properties <em>released</em> and <em>lengthInMinutes</em> to the
movie <em>Batman Begins</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (m:Movie)
WHERE m.title = 'Batman Begins'
SET m.released = 2005, m.lengthInMinutes = 140
RETURN m</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (m:Movie)
WHERE m.title = 'Batman Begins'
SET  m = {title: 'Batman Begins',
          released: 2005,
          lengthInMinutes: 140,
          videoFormat: 'DVD',
          grossMillions: 206.5}
RETURN m</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (m:Movie)
WHERE m.title = 'Batman Begins'
SET m += {
        grossMillions: 300,
        awards: 66
        }
RETURN m</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_removing_properties_from_a_node">Removing properties from a node</h5>
<div class="paragraph">
<p>There are two ways that you can remove a property from a node:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Using the <strong>REMOVE</strong> keyword:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">REMOVE x.propertyName</code></pre>
</div>
</div>
</li>
<li>
<p>Set the property’s value to <code>null</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">SET x.propertyName = null</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>For example if we want to remove the video format and the gross millions
from the batman begins film we can execute this query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (m:Movie)
WHERE m.title = 'Batman Begins'
SET m.grossMillions = null
REMOVE m.videoFormat
RETURN m</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_exercises_part_eight">Exercises part eight</h5>
<div class="paragraph">
<p><strong><em>on neof4j browser run the command <code>:play intro-neo4j-exercises</code> and
follow exercise 8 instructions</em></strong></p>
</div>
<div class="paragraph">
<p>First of all use the script found at
Cypher/exercises/part_one/createGraph.cql to create the basic graph:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">Added 171 labels, created 171 nodes, set 564 properties, created 253 relationships, completed after 24 ms.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 8.1: Create a Movie node for the movie with the title, Forrest
Gump.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CREATE (:Movie {title: 'Forrest Gump'})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 8.2: Retrieve the newly-created node.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (forrest:Movie {title: 'Forrest Gump'})
RETURN forrest</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 8.3: Create a Person node for the person with the name, Robin
Wright.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CREATE (rob:Person {name: 'Robin Wright'})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 8.4: Retrieve the newly-created node.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (rob:Person {name: 'Robin Wright'})
RETURN rob</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 8.5: Add the label OlderMovie to any Movie node that was
released before 2010.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (oldMov:Movie)
WHERE oldMov.released &lt; 2010
SET oldMov:OlderMovie
RETURN DISTINCT labels(oldMov)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 8.6: Retrieve all older movie nodes to test that the label was
indeed added to these nodes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (old:OlderMovie)
RETURN old.title, old.released
ORDER BY old.released DESC</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 8.7: Add the label Female to all Person nodes that has a person
whose name starts with Robin.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (female:Person)
WHERE female.name STARTS WITH 'Robin'
SET female:Female
RETURN DISTINCT labels(female)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 8.8: Retrieve all Female nodes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (female:Female)
RETURN female</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 8.9: We’ve decided to not use the Female label. Remove the
Female label from the nodes that have this label.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (female:Female)
REMOVE female:Female
RETURN female</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 8.10: View the current schema of the graph.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CALL db.schema</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 8.11: Add the following properties to the movie, Forrest Gump:
<code>released: 1994</code>,
<code>tagline: Life is like a box of chocolates…​you never know what you’re gonna get.</code>,
<code>lengthInMinutes: 142</code>,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (mov:Movie {title: 'Forrest Gump'})
SET mov += {
    released: 1994,
    tagline: 'Life is like a box of chocolates…​you never know what you’re gonna get.',
    leghtInMinutes: 142
}
SET mov:OlderMovie</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 8.12: Retrieve this OlderMovie node to confirm that the
properties and label have been properly set.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (p:OlderMovie)
WHERE p.title = 'Forrest Gump'
RETURN p</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 8.13: Add the following properties to the person, Robin Wright:
<code>born: 1966</code> and <code>birthPlace: Dallas</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (rob:Person)
WHERE rob.name = 'Robin Wright'
SET rob += {
    born: 1996,
    birthPlace: "Dallas"
}
RETURN rob.born, rob.birthPlace</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 8.14: Retrieve this Person node to confirm that the properties
have been properly set.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (rob:Person {name: 'Robin Wright'})
RETURN rob</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 8.15: Remove the lengthInMinutes property from the movie,
Forrest Gump.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (mov:Movie {title: 'Forrest Gump'})
SET mov.legthInMinutes = null
return mov</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 8.16: Retrieve the Forrest Gump node to confirm that the
property has been removed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (mov:Movie {title: 'Forrest Gump})
return mov</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 8.17: Remove the birthPlace property from the person, Robin
Wright.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (rob:Person)
WHERE rob.name = 'Robin Wright'
REMOVE rob.birthPlace
RETURN rob</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 8.18: Retrieve the Robin Wright node to confirm that the
property has been removed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (rob:Person)
WHERE rob.name = 'Robin Wright'
RETURN rob</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect3">
<h4 id="_part_nine">Part Nine</h4>
<div class="sect4">
<h5 id="_creating_relationships">Creating relationships</h5>
<div class="paragraph">
<p>The relationships are created by defined the left node <code>x</code> and the right
node <code>y</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CREATE (x)&lt;-[:NAME_OF_RELATIONSHIP {name_of_property: value_of_property}]-(y)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CREATE (x)-[:NAME_OF_RELATIONSHIP {name_of_property: value_of_property}]-&gt;(y)</code></pre>
</div>
</div>
<div class="paragraph">
<p>When a relationship is created it must have a direction unlike the non
creational queries. The connections capture the semantic relationships
and context of the nodes in the graph.</p>
</div>
<div class="paragraph">
<p>In most cases, unless you are connecting nodes at creation time, you
will retrive the two nodes, each with their own variables, for example,
by specifying a <strong><code>WHERE</code></strong> clause to fine them, and then use the
variables to connect them.</p>
</div>
<div class="paragraph">
<p>Here is an example: Creation of a relationship between Michael Caine
with the movie Batman Begins</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (a:Person), (m:Movie)
WHERE a.name = 'Michael Caine' AND m.title = 'Batman Begins'
CREATE (a)-[:ACTED_IN]-&gt;(m)
RETURN a, m</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another example is the creation of multiple relationships at once bu
simply providing the pattern for the creation that includes the
relationship types, their directions and the nodes that you want ot
connect.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (a:Person), (m:Movie), (p:Person)
WHERE a.name = 'Liam Neeson' AND
      m.title = 'Batman Begins' AND
      p.name = 'Benjamin Melniker'
CREATE (a)-[:ACTED_IN]-&gt;(m)&lt;-[:PRODUCED]-(p)
RETURN a, m, p</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_adding_properties_to_relationships">Adding properties to relationships</h5>
<div class="paragraph">
<p>Just like the adding properties to a node, the same is for the
relationships.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">SET relationship.propertyName = value</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">SET relationship.propertyName1 = value1 , relationship.propertyName2 = value2</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">SET r = {propertyName1: value1, propertyName2: value2}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">SET r += {propertyName1: value1, propertyName2: value2}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The same rules of adding properties node is apply to the properties of
relationships.</p>
</div>
<div class="paragraph">
<p>Here is an example: Add the <code>roles</code> property to the ACTED_IN
relationship from <em>Christian Bale</em> to <em>Batman Begins</em> right after
creation of the relationship.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (act:Person), (mov:Movie)
WHERE act.name = 'Christian Bale' AND mov.title = 'Batman Begins'
CREATE (act)-[rel:ACTED_IN]-&gt;(mov)
SET rel.roles = ['Bruce Wayne', 'Batman']
RETURN act, rel, mov</code></pre>
</div>
</div>
<div class="paragraph">
<p>To prevent the useless executions of create and set it can be possible
to add a condition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (act:Person), (mov:Movie)
WHERE act.name = 'Christian Bale' AND
      mov.title = 'Batman Begins' AND
      NOT exists((a)-[:ACTED_IN]-&gt;(MOV))
CREATE (act)-[rel:ACTED_IN]-&gt;(mov)
SET rel.roles = ['Bruce Wayne', 'Batman']
RETURN act, rel, mov</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_removing_properties_to_relationships">Removing properties to relationships</h5>
<div class="paragraph">
<p>Same as removing properties from nodes it can be possible to remove
properties from relationships.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (a:Person)-[rel:ACTED_IN]-&gt;(m:Movie)
WHERE a.name = 'Christian Bale' AND
      m.title = 'Batman Begins'
REMOVE rel.roles
RETURN a, rel, m</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_exercises_part_nine">Exercises part nine</h5>
<div class="paragraph">
<p><strong><em>on neof4j browser run the command <code>:play intro-neo4j-exercises</code> and
follow exercise 9 instructions</em></strong></p>
</div>
<div class="paragraph">
<p>First of all use the script found at
Cypher/exercises/part_one/createGraph.cql to create the basic graph:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">Added 171 labels, created 171 nodes, set 564 properties, created 253 relationships, completed after 24 ms.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 9.1: Create the ACTED_IN relationship between the actors, Robin
Wright, Tom Hanks, and Gary Sinise and the movie, Forrest Gump.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (mov:Movie)
WHERE mov.title = 'Forrest Gump'
MATCH (act:Person)
WHERE act.name = 'Robin Wright' OR
      act.name = 'Tom Hanks' OR
      act.name = 'Gary Sinise'
CREATE (act)-[:ACTED_IN]-&gt;(mov)
RETURN act, mov</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 9.2: Create the DIRECTED relationship between Robert Zemeckis
and the movie, Forrest Gump.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (act:Person), (mov:Movie)
WHERE mov.title = 'Forrest Gump' AND
      act.name = 'Robert Zemeckis'
CREATE (act)-[rel:DIRECTED]-&gt;(mov)
RETURN act, rel, mov</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 9.3: Create a new relationship, HELPED from Tom Hanks to Gary
Sinise.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (tom:Person), (gar:Person)
WHERE tom.name = 'Tom Hanks' AND gar.name = 'Gary Sinise'
CREATE (tom)-[rel:HELPED]-&gt;(gar)
RETURN tom, rel, gar</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 9.4: Write a Cypher query to return all nodes connected to the
movie, Forrest Gump, along with their relationships.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (pers:Person)-[rel]-(mov:Movie)
WHERE mov.title = 'Forrest Gump' AND exists(rel)
RETURN pers,rel, mov</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 9.5: Add the roles property to the three ACTED_IN relationships
that you just created to the movie, Forrest Gump using this information:
Tom Hanks played the role, Forrest Gump. Robin Wright played the role,
Jenny Curran. Gary Sinise played the role, Lieutenant Dan Taylor.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (actor:Person)-[rel:ACTED_IN]-&gt;(mov:Movie)
WHERE mov.title = 'Forrest Gump'
SET rel.roles = CASE actor.name
                    WHEN 'Tom Hanks'
                        THEN ['Forrest Gump']
                    WHEN 'Robin Wright'
                        THEN ['Jenny Curran']
                    WHEN 'Gary Sinise'
                        THEN ['Lieutenant Dan Taylor']
                END
RETURN actor, rel, mov</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 9.6: Add a new property, research to the HELPED relationship
between Tom Hanks and Gary Sinise and set this property’s value to war
history.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (tom:Person)-[rel:HELPED]-&gt;(gar:Person)
WHERE tom.name = 'Tom Hanks' AND gar = 'Gary Sinise'
SET rel.research = 'war history'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 9.7: View the current list of property keys in the graph.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CALL db.propertyKeys</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 9.8: View the current schema of the graph.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CALL db.schema</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 9.9: Query the graph to return the names and roles of actors in
the movie, Forrest Gump.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (act:Person)-[rel:ACTED_IN]-&gt;(mov:Movie)
WHERE mov.title = 'Forrest Gump'
RETURN act.name, rel.roles</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 9.10: Query the graph to retrieve information about any HELPED
relationships.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (pers:Person)-[help:HELPED]-&gt;(someone:Person)
RETURN pers.name, help, someone.name</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 9.11: Modify the role that Gary Sinise played in the movie,
Forrest Gump from Lieutenant Dan Taylor to Lt. Dan Taylor.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (:Person {name: 'Gary Sinise'})-[rel:ACTED_IN]-&gt;(:Movie {title: 'Forrest Gump'})
SET rel.roles = 'Lt. Dan Taylor'
RETURN rel.roles</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 9.12: Remove the research property from the HELPED relationship
from Tom Hanks to Gary Sinise.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (:Person {name: 'Tom Hanks'})-[rel:HELPED]-&gt;(:Person {name: 'Gary Sinise'})
REMOVE rel.research
RETURN rel</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 9.13: Query the graph to confirm that your modifications were
made to the graph.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (p:Person)-[]-&gt;(m:Movie {title: 'Forrest Gump'})
RETURN p, m</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect3">
<h4 id="_part_ten">Part Ten</h4>
<div class="sect4">
<h5 id="_deleting_nodes_and_relationships">Deleting nodes and relationships</h5>
<div class="paragraph">
<p>If a node has no relationships to any other nodes, it’s possible to
simply delete it from the graph using the <strong><code>DELETE</code></strong>.</p>
</div>
<div class="paragraph">
<p>The graph engine return errors if attempt to delete a node in the graph
that has relationships in or out of the node, this is because deleting
such a node will leave <em>orphaned</em> relationships in the graph.</p>
</div>
<div class="paragraph">
<p>To delete a relationship between nodes it’s necessary to find it first
in the graph and then deleting it.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Delete the ACTED_IN relationship between Christian Bale and the movie
Batman Begins:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (a:Person)-[rel:ACTED_IN]-&gt;(m:Movie)
WHERE a.name = 'Christian Bale' AND 'm.title = 'Batman Begins'
DELETE rel
RETURN a, m</code></pre>
</div>
</div>
</li>
<li>
<p>Delete the node <em>Benjamin Melniker</em> and his relationships to movie
nodes. To make this works it’s necessary to remove the relationships to
prevent errors:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (p:Person)-[rel:PRODUCED]-&gt;(:Movie)
WHERE p.name = 'Benjamin Melniker'
DELETE rel, p</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The most efficient way to delete a node and its corresponding
relationships is to specify <strong><code>DETACH DELETE</code></strong>. With this specification,
the relationships to and from the node are deleted then the node is
deleted.</p>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>This gives errors:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (p:Person)
WHERE p.name = 'Liam Neeson'
DELETE p</code></pre>
</div>
</div>
</li>
<li>
<p>This not gives errors:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (p:Person)
WHERE p.name = 'Liam Neeson'
DETACH DELETE p</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_exercises_part_ten">Exercises part ten</h5>
<div class="paragraph">
<p><strong><em>on neof4j browser run the command <code>:play intro-neo4j-exercises</code> and
follow exercise 10 instructions</em></strong></p>
</div>
<div class="paragraph">
<p>First of all use the script found at
Cypher/exercises/part_one/createGraph.cql to create the basic graph:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">Added 171 labels, created 171 nodes, set 564 properties, created 253 relationships, completed after 24 ms.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 10.1: Delete the HELPED relationship from the graph.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH ()-[rel:HELPED]-()
DELETE rel
return rel</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 10.2: Query the graph to confirm that the relationship no
longer exists.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CALL db.relationshipTypes</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 10.3: Query the graph to display Forrest Gump and all of its
relationships.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (movie:Movie)-[rel]-(nod)
WHERE movie.title = 'Forrest Gump'
RETURN movie, rel, nod</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 10.4: Try deleting the Forrest Gump node without detaching its
relationships.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (movie:Movie)
WHERE movie.title = 'Forrest Gump'
DELETE movie</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 10.5: Delete Forrest Gump, along with its relationships in the
graph.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (movie:Movie)
WHERE movie.title = 'Forrest Gump'
DETACH DELETE movie</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 10.6: Query the graph to confirm that the Forrest Gump node has
been deleted.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (movie:Movie)-[rel]-(pers)
WHERE movie.title = 'Forrest Gump'
RETURN movie, rel, pers</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect3">
<h4 id="_part_eleven">Part Eleven</h4>
<div class="sect4">
<h5 id="_merge">Merge</h5>
<div class="paragraph">
<p>The <strong>MERGE</strong> clause is used either to create new nodes and relationships
or to make structural changes to existing nodes and relationships.</p>
</div>
<div class="paragraph">
<p>Recap of the <code>CREATE</code> clause:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">The result with <code>CREATE</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If a node with the same property value exists, a duplicate node
is creted</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Label</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the label already exists for the node, the node is not
updated</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the node or relationship property already exists, it is
updated with the new value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Relationship</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If a relationship exists, a duplicate relationship is
created</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>It’s difficult to have a graph where we want some duplicates, and the
solution for this is the <code>MERGE</code> clause. This clause is used to find
elements in the graph and if the element is not found then it will be
created:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a unique node based on label and key information for a property
and if it exists, optionally update it</p>
</li>
<li>
<p>Create a unique relationship</p>
</li>
<li>
<p>Create a node and relationship to it uniquely in the context of
another node</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MERGE (variable:Label{nodeProperties})
RETURN variable</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MERGE (a:Person {name: 'Michael Caine'}) SET a.born = 1933 RETURN a</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can repeat this query with the MERGE clause but no more Actor will be
created.</p>
</div>
<div class="paragraph">
<p>This clause can be used also to create relationships:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MERGE (variable:Label {nodeProperties})-[:REL_TYPE]-&gt;(otherNode)
RETURN variable</code></pre>
</div>
</div>
<div class="paragraph">
<p>It’s possible to leave out the direction of the relationship, if the
relationship not exists than will be created assuming the left-to-right
arrow.</p>
</div>
<div class="paragraph">
<p>Using this clause to create relationships is expensive and the
suggestion is to do only when it’s needed to ensure that a relationship
is unique and you are not sure it already exists.</p>
</div>
<div class="paragraph">
<p>To prevent this the <code>MATCH</code> clause:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (p:Person), (m:Movie)
WHERE m.title = 'Batman Begins' AND p.name ENDS WITH 'Caine'
MERGE (p)-[:ACTED_IN]-&gt;(m)
RETURN p,m</code></pre>
</div>
</div>
<div class="paragraph">
<p>You must be aware of the behavior of the <strong><code>MERGE</code></strong> clause and how it
will automatically create nodes and relationships. This clause tries to
find a full pattern and if it doesn’t find it, it creates that full
pattern. That’s why in most cases it’s suggested to first <strong><code>MERGE</code></strong> the
nodes and then the relationships afterwards.</p>
</div>
<div class="paragraph">
<p>Another property of the <strong><code>MERGE</code></strong> clause is <strong><code>ON CREATE</code></strong> used to assign
specific values to a node being created as a result of an attempt to
merge.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MERGE (a:Person {name: 'Sir Michael Caine'})
ON CREATE SET a.birthPlace = 'London',
              a.born = 1934
RETURN a</code></pre>
</div>
</div>
<div class="paragraph">
<p>The SET clause will be used only if the node is not found, the clause
will be skipped otherwise.</p>
</div>
<div class="paragraph">
<p>Like <code>ON CREATE</code> it exists another clause for the matching case
<strong><code>ON MATCH</code></strong>, used when the node/relationship already exists.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MERGE (a:Person {name: 'Sir Michael Caine'})
ON CREATE SET a.born = 1934
              a.birthPlace = 'UK'
ON MATCH SET a.birthPlace = 'UK'
RETURN a</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_exercises_part_eleven">Exercises part eleven</h5>
<div class="paragraph">
<p><strong><em>on neof4j browser run the command <code>:play intro-neo4j-exercises</code> and
follow exercise 11 instructions</em></strong></p>
</div>
<div class="paragraph">
<p>First of all use the script found at
Cypher/exercises/part_one/createGraph.cql to create the basic graph:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">Added 171 labels, created 171 nodes, set 564 properties, created 253 relationships, completed after 24 ms.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 11.1: Use MERGE to create (ON CREATE) a node of type Movie with
the title property, Forrest Gump. If created, set the released property
to 1994.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MERGE (mov:Movie {title: 'Forest Gump'})
ON CREATE
    SET mov.released = 1994
RETURN mov</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 11.2: Use MERGE to update (ON MATCH) a node of type Movie with
the title property, Forrest Gump. If found, set the tagline property to
``Life is like a box of chocolates…​you never know what you’re gonna
get.''.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MERGE (mov:Movie {title: 'Forrest Gump'})
ON CREATE
    SET mov.released = 1994
ON MATCH
    SET mov.tagline = 'Life is like a box of chocolates…​you never know what you’re gonna get.'
RETURN mov</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 11.3: Use MERGE to create (ON CREATE) a node of type Production
with the title property, Forrest Gump. If created, set the property year
to the value 1994.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MERGE (prod:Production {title: 'Forrest Gump'})
ON CREATE
    SET prod.year = 1994
RETURN prod</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 11.4: Query the graph to find labels for nodes with the title
property, Forrest Gump.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (forrest)
WHERE forrest.title = 'Forrest Gump'
RETURN labels(forrest)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 11.5: Use MERGE to update (ON MATCH) the existing Production
node for Forrest Gump to add the company property with a value of
Paramount Pictures.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MERGE (forrest:Production {title: 'Forrest Gump'})
ON MATCH
    SET forrest.property = 'Paramount Pictures'
RETURN forrest</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 11.6: Use MERGE to add the OlderMovie label to the movie,
Forrest Gump.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MERGE (mov:Movie {title: 'Forrest Gump'})
ON MATCH
    SET mov:OlderMovie
RETURN labels(mov)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 11.7: Execute the following Cypher statement that uses MERGE to
create two nodes and a single relationship</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MERGE (p:Person {name: 'Robert Zemeckis'})-[:DIRECTED]-&gt;(m {title: 'Forrest Gump'})</code></pre>
</div>
</div>
<div class="paragraph">
<p>This statement first finds all Person nodes that have only the name
property value of Robert Zemeckis. It then finds all nodes with only the
title property set to Forrest Gump. There are no Person or other nodes
that have only these properties so the graph engine creates them. Then
the graph engine creates the relationship between these two nodes. That
is, this MERGE operation creates two nodes and a single relationship. If
we had provided all of the property values for the nodes, we would not
have created the extra nodes.</p>
</div>
<div class="paragraph">
<p>In fact, you should never create nodes and relationships together like
this! This example is here to show you how powerful Cypher can be. A
best practice is to create nodes first, then relationships.</p>
</div>
<div class="paragraph">
<p>Exercise 11.8: Repeat the execution of the previous statement.</p>
</div>
<div class="paragraph">
<p>It should do nothing. A best practice is to always use MERGE to create
relationships to ensure that there will be no duplication in the graph.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MERGE (p:Person {name: 'Robert Zemeckis'})-[:DIRECTED]-&gt;(m {title: 'Forrest Gump'})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 11.9: Find the correct Person node to delete</p>
</div>
<div class="paragraph">
<p>You query the nodes before you delete them to ensure you have the
correct MATCH clauses.</p>
</div>
<div class="paragraph">
<p>Execute this query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (p:Person {name: 'Robert Zemeckis'})-[rel]-(x)
WHERE NOT EXISTS (p.born)
RETURN p, rel, x</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 11.10: Delete this Person node, along with its relationships.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (p:Person {name: 'Robert Zemeckis'})-[rel]-(x)
WHERE NOT EXISTS (p.born)
DETACH DELETE p
RETURN p, rel, x</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 11.11: Find the correct Forrest Gump node to delete by
executing this statement:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (m)
WHERE m.title = 'Forrest Gump' AND labels(m) = []
RETURN m, labels(m)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 11.12: Delete the Forrest Gump node.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (m)
WHERE m.title = 'Forrest Gump' AND labels(m) = []
DETACH DELETE m</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 11.13: Use MERGE to create the DIRECTED relationship between
Robert Zemeckis and the Movie, Forrest Gump.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MERGE (rob:Person {name: 'Robert Zemeckis})-[:DIRECTED]-&gt;(mov:Movie {title: 'Forrest Gump})
RETURN rob, mov</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 11.14: Use MERGE to create the ACTED_IN relationship between
the actors, Tom Hanks, Gary Sinise, and Robin Wright and the Movie,
Forrest Gump.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (pers:Person), (m:Movie)
WHERE
    pers.name IN ['Tom Haks', 'Gary Sinise', 'Robin Wright'] AND
    m.title = 'Forrest Gump'
MERGE (pers)-[:ACTED_IN]-&gt;(m)
RETURN pers, m</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 11.15: Modify the relationship property, role for their roles
in Forrest Gump: <code>Tom Hanks is Forrest Gump</code>,
<code>Gary Sinise is Lt. Dan Taylor</code>, <code>Robin Wright is Jenny Curran</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (pers:Person)-[rel:ACTED_IN]-&gt;(m:Movie)
WHERE m.title = 'Forrest Gump'
SET rel.roles =
    CASE pers.name
        WHEN 'Tom Hanks'
            THEN ['Forrest Gump']
        WHEN 'Gary Sinise'
            THEN ['Lt. Dan Taylor']
        WHEN 'Robin Wright'
            THEN ['Jenny Curran']
    END
RETURN pers, m</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect3">
<h4 id="_part_twelve">Part Twelve</h4>
<div class="paragraph">
<p>In a deployed application, it’s not necessary to hard code the Cypher
statements. In this case we are going to use a variety of values to
test, but we don’t want to chenge every time the values of test. In
addition, typically we include Cypher statements in an application where
parameters are passed in the Cypher statement before it executes. For
these scenarios, we need to parameterize values in the Cypher
statements.</p>
</div>
<div class="sect4">
<h5 id="_parameters">Parameters</h5>
<div class="paragraph">
<p>In the Cypher statements, a parameter name begins with the <code>$</code> symbol.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (p:Person)-[:ACTED_IN]-&gt;(m:Movie)
WHERE p.name = $actorName
RETURN m.released, m.title
ORDER BY m.released DESC</code></pre>
</div>
</div>
<div class="paragraph">
<p>At runtime, if the parameter <code>$actorName</code> has a value, it will be used
in the Cypher statement when it runs in the graph engine.</p>
</div>
<div class="paragraph">
<p>In Neo4j Browser to set values of parameters we can use the command
<code>:param</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">:param actorName =&gt; 'Tom Hanks'</code></pre>
</div>
</div>
<div class="paragraph">
<p>This set the parameter actorName with the value <em>Tom Hanks</em>.</p>
</div>
<div class="paragraph">
<p>The result of this command is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "actorName": "Tom Hanks"
}
See :help param for usage of the :param command.</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a client-side browser command, so it not work outside of that.</p>
</div>
<div class="paragraph">
<p>Once this parameter is setted, it can be used to do queries.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (p:Person)-[:ACTED_IN]-&gt;(m:Movie)
WHERE p.name = $actorName
RETURN m.released, m.title
ORDER BY m.released DESC</code></pre>
</div>
</div>
<div class="paragraph">
<p>Eventually the parameter can be reset with another value and the query
can be reused without touch the statements.</p>
</div>
<div class="paragraph">
<p>To set value for more than one parameters it can be use the JSON-style
format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">:params {actorName: 'Tom Cruise`, movieName: `Top Gun`}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To remove a parameter from the list simply run the command without the
parameter unwanted.</p>
</div>
<div class="paragraph">
<p>To show the list of the parameters in use for the session execute the
<code>:param</code> command without any definition of parameters.</p>
</div>
</div>
<div class="sect4">
<h5 id="_exercises_part_twelve">Exercises part twelve</h5>
<div class="paragraph">
<p><strong><em>on neof4j browser run the command <code>:play intro-neo4j-exercises</code> and
follow exercise 12 instructions</em></strong></p>
</div>
<div class="paragraph">
<p>First of all use the script found at
Cypher/exercises/part_one/createGraph.cql to create the basic graph:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">Added 171 labels, created 171 nodes, set 564 properties, created 253 relationships, completed after 24 ms.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 12.1: Write and execute a Cypher query that returns the names
of people who reviewed movies and the actors in these movies by
returning the name of the reviewer, the movie title reviewed, the
release date of the movie, the rating given to the movie by the
reviewer, and the list of actors for that particular movie.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (rev:Person)-[review:REVIEWED]-&gt;(mov:Movie),
      (act:Person)-[:ACTED_IN]-&gt;(mov)
WITH rev, review, mov, collect(act.name) AS actors
RETURN DISTINCT rev.name AS `Reviewer`,
       mov.title AS `Movie`,
       mov.released AS `Released`,
       review.rating AS `Rated`,
       actors AS `Actors`</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 12.2: Add a parameter named year to your session with a value
of 2000.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">:param year =&gt; 2000</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 12.3: Modify the Cypher query you just wrote to filter by the
year parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (rev:Person)-[review:REVIEWED]-&gt;(mov:Movie),
      (act:Person)-[:ACTED_IN]-&gt;(mov)
WITH rev, review, mov, collect(act.name) AS actors
WHERE mov.released = $year
RETURN DISTINCT rev.name AS `Reviewer`,
       mov.title AS `Movie`,
       review.rating AS `Rated`,
       actors AS `Actors`</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 12.4: Modify the year parameter to be a different value, 2006,
and retest your query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">:param year =&gt; 2006</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 12.5: Add a parameter named ratingValue to your session with a
value of 65.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">:param ratingValue =&gt; 65</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 12.6: Modify the query you wrote previously to also filter the
result returned by the rating for the movie.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (rev:Person)-[review:REVIEWED]-&gt;(mov:Movie),
      (act:Person)-[:ACTED_IN]-&gt;(mov)
WITH rev, review, mov, collect(act.name) AS actors
WHERE mov.released = $year AND
      review.rating = $ratingValue
RETURN DISTINCT rev.name AS `Reviewer`,
       mov.title AS `Movie`,
       review.rating AS `Rated`,
       actors AS `Actors`</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 12.7: Modify the ratingValue parameter to be a different value,
60, and retest your query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">:param ratingValue =&gt; 60</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect3">
<h4 id="_part_thirteen">Part Thirteen</h4>
<div class="sect4">
<h5 id="_explain_profile">Explain Profile</h5>
<div class="paragraph">
<p><strong><em>on neof4j browser run the command `:help EXPLAIN`</em></strong></p>
</div>
<div class="paragraph">
<p>The graphs studies during this notes is a very small graphs and the
problems for the rapresentation become much more harder when the dataset
grows larger and larger.</p>
</div>
<div class="paragraph">
<p>With larger graphs it will be important to not only add appropriate
indexes but also write Cypher statements that execute as efficently as
possible.</p>
</div>
<div class="paragraph">
<p>There are two Cypher keywords to use as prefix with a Cypher statement
to analyze a query:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>EXPLAIN</code></strong> provides estimates of the graph engine processing that
will occur, but does not execute the statement.</p>
</li>
<li>
<p><strong><code>PROFILE</code></strong> provides real profiling information for what has occurred
in the graph engine during the query and executes the statement.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The EXPLAIN option provides the query plan. With this it can be possible
to compare different statements to understand the stages of processing
that will occur when the Cypher executes.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">EXPLAIN
MATCH (p:Person)-[:ACTED_IN]-&gt;(m:Movie)
WHERE p.name = $actorName AND
      m.released &lt; $year
RETURN p.name, m.title, m.released</code></pre>
</div>
</div>
<div class="paragraph">
<p>This query return the phases of the Cypher execution, it can be possible
to examine what code is expected to run. Each phase of the query
presents an estimante of the number of rows expected to be returned.</p>
</div>
<div class="paragraph">
<p>For a better metric for analyzing how the Cypher statement will run is
needed to run the PROFILE prefix keyword which runs the statement and
gives the run-time performance metrics.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">PROFILE
MATCH (p:Person)-[:ACTED_IN]-&gt;(m:Movie)
WHERE p.name = $actorName AND
      m.released &lt; $year
RETURN p.name, m.title, m.released</code></pre>
</div>
</div>
<div class="paragraph">
<p>This query above show the cache hits and most importantly the number of
times that the engine accessed the database (db hints). This is the
metric that will affect the performance of the Cypher statement at
run-time.</p>
</div>
<div class="paragraph">
<p>There are two reasons why a query may take long time:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The query returns a lot of data &#8594; the query completes execution in
the graph engine, but it takes log time to create the result stream:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (a)--(b)--(c)--(d)--(e)--(f)
RETURN a</code></pre>
</div>
</div>
</li>
<li>
<p>The query takes a long time to execute in the graph engine:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (a),(b),(c),(d),(e)
RETURN count(id(a))</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the query executes and then returns a lots of data, there is no way
to monitor it or kill the query, the only think to do is to close the
session of the browser and start a new one. If the server has many of
these rogue querise running, it will slow down considerably so you
should aim to limit these types of queries. If the query is a
<strong>long-running query</strong>, it’s possible to monitor it buy using the
<code>:queries</code> command. This command calls the <code>dbms.listQueries</code> under the
hood. It can be possible to kill a query by using the icon to the right,
alternatively execute the statement <code>CALL dbms.killQuery('query-id')</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_exercises_part_thirteen">Exercises part thirteen</h5>
<div class="paragraph">
<p><strong><em>on neof4j browser run the command <code>:play intro-neo4j-exercises</code> and
follow exercise 13 instructions</em></strong></p>
</div>
<div class="paragraph">
<p>First of all use the script found at
Cypher/exercises/part_one/createGraph.cql to create the basic graph:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">Added 171 labels, created 171 nodes, set 564 properties, created 253 relationships, completed after 24 ms.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 13.1: View the query plan for a Cypher statement.</p>
</div>
<div class="paragraph">
<p>For this Part of the exercise, you will use the query that you wrote
previously using Cypher parameters. It assumes that you have set the
year and ratingValue Cypher parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (r:Person)-[rel:REVIEWED]-&gt;(m:Movie)&lt;-[:ACTED_IN]-(a:Person)
WHERE m.released = $year AND
      rel.rating &gt; $ratingValue
RETURN  DISTINCT r.name, m.title, m.released, rel.rating, collect(a.name)</code></pre>
</div>
</div>
<div class="paragraph">
<p>View the query plan for this Cypher statement.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">EXPLAIN
MATCH (r:Person)-[rel:REVIEWED]-&gt;(m:Movie)&lt;-[:ACTED_IN]-(a:Person)
WHERE m.released = $year AND
      rel.rating &gt; $ratingValue
RETURN  DISTINCT r.name, m.title, m.released, rel.rating, collect(a.name)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 13.2: View the metrics for the query when the previous
statement executes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">PROFILE
MATCH (r:Person)-[rel:REVIEWED]-&gt;(m:Movie)&lt;-[:ACTED_IN]-(a:Person)
WHERE m.released = $year AND
      rel.rating &gt; $ratingValue
RETURN  DISTINCT r.name, m.title, m.released, rel.rating, collect(a.name)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 13.3: Remove the labels from the nodes and relationships in the
query and again view the metrics. Compare the db hits from the previous
version of the statement.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">PROFILE
MATCH (r)-[rel]-&gt;(m)&lt;-[]-(a)
WHERE m.released = $year AND
      rel.rating &gt; $ratingValue
RETURN  DISTINCT r.name, m.title, m.released, rel.rating, collect(a.name)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 13.4: Recall that a query may run for a long time because there
are a lot of results to return</p>
</div>
<div class="paragraph">
<p>The query takes a long time to execute in the graph engine.</p>
</div>
<div class="paragraph">
<p>You will perform these steps to gain some experience with monitoring and
killing queries by having your original Neo4j Browser window open and
then opening another Neo4j Browser window.</p>
</div>
<div class="paragraph">
<p>Open a second Neo4j Browser session. This session will be used for
monitoring queries as they run.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">:queries</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 13.5: Execute this long-running query in your original Neo4j
Browser session that returns a lot of results. In the second Neo4j
Browser window, monitor the running queries.</p>
</div>
<div class="paragraph">
<p>Here is a very bad Cypher statement to use that returns a lot of
results:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">PROFILE MATCH (a)--(b)--(c)--(d)--(e)--(f)--(g)
RETURN a</code></pre>
</div>
</div>
<div class="paragraph">
<p>What do you see in the second Neo4j Browser window where you are
monitoring queries?</p>
</div>
<div class="paragraph">
<p>While the query in the original Neo4j Browser window is executing, in
the second Neo4j Browser window i can see the state of the <code>PROFILE</code>
query.</p>
</div>
<div class="paragraph">
<p>Exercise 13.6: Execute this long-running query in your original Neo4j
Browser session and monitor the query in the second Neo4j Browser
session.</p>
</div>
<div class="paragraph">
<p>Here is a very bad Cypher statement that takes a lot of time to execute
in the graph engine:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">PROFILE MATCH (a), (b), (c), (d), (e) , (f), (g)
RETURN count(id(a))</code></pre>
</div>
</div>
<div class="paragraph">
<p>What do you see in the second Neo4j Browser window where you are
monitoring queries?</p>
</div>
<div class="paragraph">
<p>Same as exercise 5 but this query never finished yet.</p>
</div>
<div class="paragraph">
<p>Exercise 13.7: In the second Neo4j Browser window, kill the long-running
query.</p>
</div>
<div class="paragraph">
<p>Double click in the minus button.</p>
</div>
<hr>
</div>
<div class="sect4">
<h5 id="_part_fourteen">Part Fourteen</h5>

</div>
<div class="sect4">
<h5 id="_managing_constraints_and_node_keys">Managing constraints and node keys</h5>
<div class="paragraph">
<p>We are already said that we need to prevent the duplications of the
nodes and data, it’s not possible to prevent duplication by checking the
existence of the exact node (with properties) as this type of test is
not cluster or multi-thread safe as mp òpcls are ised. This is why the
MERGE clause is preferred over the CREATE because MERGE does use locks.</p>
</div>
<div class="paragraph">
<p>To define some rules above this problems we can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add a uniqueness constraint that ensures that a value for a property
is unique for all nodes of that type.</p>
</li>
<li>
<p>Add an existence constraint that ensure that when a node or
relationship is created or modified, ti must have certain properties
set.</p>
</li>
<li>
<p>Add a node key that ensures that a set of values for properties of a
node of a given type is unique.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_constraint_properties">Constraint properties</h5>
<div class="paragraph">
<p>We add a uniqueness constraint to the graph by creating a constraint
that asserts that a particular node property is unique in the graph for
a particular type of node.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CREATE CONSTRAINT ON (m:Movie) ASSERT m.title IS UNIQUE</code></pre>
</div>
</div>
<div class="paragraph">
<p>This statement will fail if the graph already has multiple Movie nodes
with the same value for the title property.</p>
</div>
<div class="paragraph">
<p>If we attempt to create a Movie with the title <em>`The Matrix`</em> the Cypher
statement will fail baceuse the graph already has a movie with that
title. Also when we attempt to modify the value of a property where the
uniqueness assertion fails the Cypher statement will fail.</p>
</div>
<div class="paragraph">
<p>If we attempt to add a new constraint to a property of some label and
this property is not set for some nodes with that label, than the query
will fail because we cannot set a new constraint without first make this
new rule applicable.</p>
</div>
<div class="paragraph">
<p>We can also create a constraint on properties of relationships, it’s not
necessary to define the direction of the relationship:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CREATE CONSTRAINT ON ()-[rel:REVIEWED]-() ASSERT exists(rel.rating)</code></pre>
</div>
</div>
<div class="paragraph">
<p>To retrieving constraints defined for the graph we can run the command
<code>:schema</code> to view existing indexes and contraints defined for the graph.</p>
</div>
<div class="paragraph">
<p>The <code>CALL db.constraints()</code> will return the statements of all the
constraints.</p>
</div>
<div class="paragraph">
<p>To delete a constraints it can be run the <strong><code>DROP</code></strong> clause followed by
the statements of the constraints to delete:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">DROP CONSTRAINT ON ()-[rel:REVIEWED]-() ASSERT exists(rel.rating)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_constraint_node_keys">Constraint node keys</h5>
<div class="paragraph">
<p>A node key is used to define the uniqueness constraint for multiple
properties of a node of a certain type. A node key is also used as a
composite index in the graph.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CREATE CONSTRAINT ON (p:Person) ASSERT (p.name, p.born) IS NODE KEY</code></pre>
</div>
</div>
<div class="paragraph">
<p>This prevent the duplication of nodes.</p>
</div>
</div>
<div class="sect4">
<h5 id="_exercises_part_fourteen">Exercises part fourteen</h5>
<div class="paragraph">
<p><strong><em>on neof4j browser run the command <code>:play intro-neo4j-exercises</code> and
follow exercise 14 instructions</em></strong></p>
</div>
<div class="paragraph">
<p>First of all use the script found at
Cypher/exercises/part_one/createGraph.cql to create the basic graph:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">Added 171 labels, created 171 nodes, set 564 properties, created 253 relationships, completed after 24 ms.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 14.1: Add a uniqueness constraint to the Person nodes in the
graph.</p>
</div>
<div class="paragraph">
<p>Suppose we want to ensure that every Person in the graph must have a
unique name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CREATE CONSTRAINT ON (p:Person) ASSERT p.name IS UNIQUE</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 14.2: Add Tom Hanks to the graph.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CREATE (tom:Person {name: 'Tom Hanks'})
RETURN tom.name</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 14.3: Attempt to add an existence constraint to the Person
nodes in the graph.</p>
</div>
<div class="paragraph">
<p>Suppose we want to ensure that every Person node in the graph has a born
property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CREATE CONSTRAINT ON (p:Person) ASSERT exists(p.born)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 14.4: Update the existing Person nodes so that you set the born
property to 0 for any nodes that do not exist.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (per:Person)
WHERE NOT exists(per.born)
SET per.born = 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 14.5: Add the existence constraint to the graph for the born
property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CREATE CONSTRAINT ON (per:Person) ASSERT exists(per.born)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 14.6: Add Sean Penn to the graph where you do not specify a
value for born.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CREATE (:Person {name: 'Sean Penn'})
RETURN p</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 14.7: Add an existence constraint to the ACTED_IN relationship
in the graph.</p>
</div>
<div class="paragraph">
<p>Suppose we want to ensure that every ACTED_IN relationship must have a
value for the roles property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CREATE CONSTRAINT ON ()-[act:ACTED_IN]-() ASSERT exists(act-roles)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 14.8: Add an ACTED_IN relationship from the person, Emil Eifrem
to the movie, Forrest Gump where the roles property is not set.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (em:Person {name: 'Emil Eifrem'}), (movie:Movie {title: 'Forrest Gump'})
MERGE (em)-[:ACTED_IN]-&gt;(movie)
RETURN em</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 14.9: Suppose we want to ensure that the graph will never
contain a movie with the same title and the same year. For example, the
movie studio decides to release a movie with the title, Back to the
Future in 2018. There already is a movie in the graph with this title
that was released in 1985. We want to allow this. To implement this type
of constraint on the graph, you must add a constraint as a node key
since it uses two properties of the node.</p>
</div>
<div class="paragraph">
<p>Note: If you have created a uniqueness constraint to the graph for the
title property (as shown in the module content), you must first drop the
constraint as it no longer makes sense if we are to allow duplicate
titles in the graph. You must write and execute the statement to drop
the constraint if it exists:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">DROP CONSTRAINT ON (m:Movie) ASSERT m.title IS UNIQUE</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add a node key to the graph that will ensure that the combined values of
title and released are unique for all Movie nodes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CREATE CONSTRAINT ON (m:Movie) ASSERT (m.title, m.released) IS NODE KEY</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 14.10: Add the movie, Back to the Future with a released value
of 1985 and a tagline value of Our future..</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CREATE (m:Movie {title: 'Back to the Future', released: 1985, tagline: 'hello future'})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 14.11: Add the movie, Back to the Future with a released value
of 2018 and a tagline value of The future is ours..</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CREATE (m:Movie {title: 'Back to the Future', released: 2018, tagline: 'this future'})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 14.12: Try adding the 2018 movie again.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CREATE (m:Movie {title: 'Back to the Future', released: 2018, tagline: 'this future'})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 14.13: Display the list of constraints defined in the graph.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CALL db.constraints</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 14.14: Drop the constraint that requires the ACTED_IN
relationship to have a property, roles.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">DROP CONSTRAINT ON ()-[ acted_in:ACTED_IN ]-() ASSERT exists(acted_in.roles)</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect3">
<h4 id="_part_fiveteen">Part Fiveteen</h4>
<div class="sect4">
<h5 id="_managing_indexes">Managing indexes</h5>
<div class="paragraph">
<p>The uniqueness and node key constraints are essentially single-property
and composite indexes respectively. Indexes are used to improve initial
node lookup performance, but they require additional storage in the
graph to maintain and also add to the cost of creating or modifying
property values that are indexed. Indexes store redundant data that
points to nodes with the specific property value or values. Unlike SQL,
there is no such thing as a primary key in Neo4j, but nodes can have
multiple properties that must be unique.</p>
</div>
<div class="paragraph">
<p>This are single-property indexes used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Equality checks: <code>=</code></p>
</li>
<li>
<p>Range comparisons: <code>&gt;</code>,<code>&gt;=</code>,<code>&lt;</code>, <code>&#8656;</code></p>
</li>
<li>
<p>List membership: <code>IN</code></p>
</li>
<li>
<p>String comparisons: <code>STARTS WITH</code>, <code>ENDS WITH</code>, <code>CONTAINS</code></p>
</li>
<li>
<p>Existence checks: <code>exists()</code></p>
</li>
<li>
<p>Spatial distance searches: <code>distance()</code></p>
</li>
<li>
<p>Spatial bounding searches: <code>point()</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Composite indexes are used only for equality checks and list membership.</p>
</div>
<div class="paragraph">
<p><strong><em>For more about indexes &#8594;
<a href="https://neo4j.com/docs/operations-manual/current/">neo4j operations
manual</a></em></strong></p>
</div>
<div class="paragraph">
<p>Because index maintenance incurs additional overhead when nodes are
created so it’s not raccomend to create indexes in a small graph. The
indexes of a graph can be view by use the build-in command <code>schema</code>.</p>
</div>
<div class="paragraph">
<p>The index for a property of a node can greatly reduce the number of
nodes that the engine needs to visit in oredr to satisy a query.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (m:Movie)
WHERE 1990 &lt; m.released &lt; 2000
SET m.videoFormat = 'DVD'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The graph engine will find the pointers to all nodes that satisfy the
query without having to visit all of the nodes:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="resources/indexesRange.png" alt="indexes range"></span></p>
</div>
<div class="paragraph">
<p>Indexes improve graph engine performance. A unique constraint on a
property is an index so it’s not needed to create an index for any
properties created with uniqueness constraints for, but an index on its
own does not guarantee uniqueness.</p>
</div>
<div class="paragraph">
<p>To create a single-property index it’s necessary to use the
<code>CREATE INDEX ON</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CREATE INDEX ON :Movie(released)</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a set of properties for a node must be unique for every node, then
it’s recommend to create a constraint as a node key, rather than an
index. If there can be duplication for a set of property values, but the
faster access it’s necessary than the composite index is necessary.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (m:Movie)
WHERE m.released &gt;= 2000
SET m.videoFormat = 'DVD';
MATCH (m:Movie)
WHERE m.released &lt; 2000
SET m.videoFormat = 'VHS';
CREATE INDEX ON :Movie(released,videoFormat)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This queries set two new properties and with the last query create
composite index on these properties.</p>
</div>
<div class="paragraph">
<p>To retrive indexes there is a build-in method call <code>:schema</code>, similar to
<code>CALL db.constraints()</code>, that return a list of the indexes, and the
unique constraints and node key shown as indexes in the graph.</p>
</div>
<div class="paragraph">
<p>To drop an existing index created it’s possible to use the clause <code>DROP</code>
instead of <code>CREATE</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">DROP INDEX ON :Movie(released, videoFormat)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_exercises_part_fiveteen">Exercises part fiveteen</h5>
<div class="paragraph">
<p><strong><em>on neof4j browser run the command <code>:play intro-neo4j-exercises</code> and
follow exercise 15 instructions</em></strong></p>
</div>
<div class="paragraph">
<p>First of all use the script found at
Cypher/exercises/part_one/createGraph.cql to create the basic graph:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">Added 171 labels, created 171 nodes, set 564 properties, created 253 relationships, completed after 24 ms.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 15.1: Create a single-property index on the born property of a
Person node.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CREATE INDEX ON :Person(born)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 15.2: View the indexes defined for the graph.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">:schema</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 15.3: Drop the single-property index you just created for the
born property of the Person nodes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">DROP INDEX ON :Person(born)</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect3">
<h4 id="_part_sixteen">Part Sixteen</h4>
<div class="sect4">
<h5 id="_from_relational_to_graph">From relational to graph</h5>
<div class="paragraph">
<p><strong><em><a href="https://www.youtube.com/watch?v=NO3C-CWykkY">youtube video -
(RDBMS+SQL) to (Graphs+Cypher)</a></em></strong></p>
</div>
<div class="paragraph">
<p>In many applications the datas comes from a .csv files or files of other
types and with these we want to populate our graph. There are many
nuances and best practices for loading data into graph from files.</p>
</div>
<div class="paragraph">
<p><em>To convert a relational database into a graph database with one step
you can use the ETL tool (Extract Transform Load) &#8594;
<a href="https://neo4j.com/developer/neo4j-etl/">Neo4J ETL</a></em></p>
</div>
<div class="paragraph">
<p>In Cypher it’s possible to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Load data from a URL (http(s) or file)</p>
</li>
<li>
<p>Process data as a stream of records</p>
</li>
<li>
<p>Create or update the graph with the data being loaded</p>
</li>
<li>
<p>Use transactions during the data load</p>
</li>
<li>
<p>Transform and convert values from the load stream</p>
</li>
<li>
<p>Load up to 10M nodes and relationships</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Commonly to import data into a graph is used the csv files, to do that
it’s necessary to develop a model that describes how data need to be
represents in the graph.</p>
</div>
</div>
<div class="sect4">
<h5 id="_importing_normalized_data">Importing normalized data</h5>
<div class="paragraph">
<p>The <code>LOAD CSV</code> clause parses a local in the import directory of the
neo4j installation or a remote file into a stream of rows which
represent maps (with eaders) or lists. Once done this it’s possible to
use Cypher operations to create nodes or relationships or merge existing
graph.</p>
</div>
<div class="paragraph">
<p>Syntax of LOAD CSV:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">LOAD CSV WITH HEADERS FROM url-value
AS row</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The <strong>row</strong> is a variable that is used to extract data from file.</p>
</li>
<li>
<p>The first line of the file must contain a comma-separated list of
column names.</p>
</li>
<li>
<p>The url-value can be a resource or a file on the system.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each line of this file must contains data that is interpreted as values
for each column name. When each line is read from the file, it’s
possible to perform the necessary processing to create or merge data
into the graph.</p>
</div>
<div class="paragraph">
<p>As CSV file usually represent either node or relationship lists and to
create nodes and relationships separately it’s necessary to parse
several time that file.</p>
</div>
<div class="paragraph">
<p>Example of csv file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csv" data-lang="csv">id,title,country,year,summary
1,Wall Street,USA,1987, Every dream has a price.
2,The American President,USA,1995, Why can't the most powerful man in the world have the one thing he wants most?
3,The Shawshank Redemption,USA,1994, Fear can hold you prisoner. Hope can set you free.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Before loading data from CSV files into graph, we need to confirm that
the data retrived looks ok. To do this we can first print the lines of
the file and get some information about the data to be loaded.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">LOAD CSV WITH HEADERS
FROM 'http://data.neo4j.com/intro-neo4j/movies_to_load.csv'
as LINE
RETURN count(*)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or even better we probably want to see how the datas are stored:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">LOAD CSV WITH HEADERS
FROM 'http://data.neo4j.com/intro-neo4j/movies_to_load.csv'
AS line
RETURN * LIMIT 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since all the lines are with the same format we can limit the
visualization to 1.</p>
</div>
<div class="paragraph">
<p>The output of the last query should be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-output" data-lang="output">line
{
  "summary": " Every dream has a
price.",
  "country": "USA",
  "year": "1987",
  "id": "1",
  "title": "Wall Street"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that the <em>summary</em> column’s data has an extra space before the
data in the file, to make sure not to load data like this we need to
beutify the output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">LOAD CSV WITH HEADERS
FROM 'http://data.neo4j.com/intro-neo4j/movies_to_load.csv'
AS line
RETURN line.id, line.title, toInteger(line.year), trim(line.summary)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output will be formatted to this:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">line.id</th>
<th class="tableblock halign-left valign-top">line.title</th>
<th class="tableblock halign-left valign-top">toInteger(line.year)</th>
<th class="tableblock halign-left valign-top">trim(line.summary)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``1''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``Wall Street''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1987</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``Every dream has a price.''</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``2''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``The American President''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1995</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``Why can’t the most powerful
man in the world have the one thing he wants most?''</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``3''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``The Shawshank Redemption''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1994</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``Fear can hold you
prisoner. Hope can set you free.''</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Now we can create nodes and relationships from this file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">LOAD CSV WITH HEADERS
FROM 'http://data.neo4j.com/intro-neo4j/movies_to_load.csv'
AS line
CREATE (movie:Movie {movieId: line.id, title: line.title, released: toInteger(line.year), tagline: trim(line.summary)})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another example can be the file that holds the data of Person:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">Id,name,birthyear
1,Charlie Sheen, 1965
2,Oliver Stone, 1946
3,Michael Douglas, 1944
4,Martin Sheen, 1940
5,Morgan Freeman, 1937</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case we need to pay more attention at the people in the database
that have already this name to prevent duplications. Instead of creating
them, we need to use the <strong><code>MERGE</code></strong> to ensure unique entries after the
import.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">LOAD CSV WITH HEADERS
FROM 'http://data.neo4j.com/intro-neo4j/person_to_load.csv'
AS line
MERGE (actor:Person {personId: line.Id})
ON CREATE
    SET actor.name = line.name, actor.born = toInteger(trim(line.birthyear))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let’s create relationships between the movies and the actors using
the csv file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csv" data-lang="csv">personId,movieId,role
1,1,Bud Fox
4,1,Carl Fox
3,1,Gordon Gekko
4,2,A.J. MacInerney
3,2,President Andrew Shepherd
5,3,Ellis Boyd 'Red' Redding</code></pre>
</div>
</div>
<div class="paragraph">
<p>The relative query will be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">LOAD CSV WITH HEADERS
FROM 'http://data.neo4j.com/intro-neo4j/roles_to_load.csv'
AS line
MATCH (movie:Movie { movieId: line.movieId })
MATCH (person:Person { personId: line.personId })
CREATE (person)-[:ACTED_IN { roles: [line.role]}]-&gt;(movie)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_importing_denormalized_data">Importing denormalized data</h5>
<div class="paragraph">
<p>When file that we need to import are denormalized a supplementary step
is needed.</p>
</div>
<div class="paragraph">
<p>There are a specifications for the field terminator of the file, this is
an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">title;released;summary;actor;birthyear;characters
Back to the Future;1985;17 year old Marty McFly got home early last night. 30 years early.;Michael J. Fox;1961;Marty McFly
Back to the Future;1985;17 year old Marty McFly got home early last night. 30 years early.;Christopher Lloyd;1938;Dr. Emmet Brown</code></pre>
</div>
</div>
<div class="paragraph">
<p>From this we want to create person and movies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">LOAD CSV WITH HEADERS
FROM 'https://data.neo4j.com/intro-neo4j/movie_actor_roles_to_load.csv'
AS line FIELDTERMINATOR ';'
MERGE (movie:Movie { title: line.title })
ON CREATE SET movie.released = toInteger(line.released),
              movie.tagline = line.summary
MERGE (actor:Person { name: line.actor })
ON CREATE SET actor.born = toInteger(line.birthyear)
MERGE (actor)-[r:ACTED_IN]-&gt;(movie)
ON CREATE SET r.roles = split(line.characters,',')</code></pre>
</div>
</div>
<div class="paragraph">
<p>Two main things to notice:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the definition of the semi-colon as a field terminator rather than
comma;</p>
</li>
<li>
<p>the build-in method <code>split()</code> to create the list for the roles
property.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>It’s suggested to create nodes and relationships separately in multiple
passes, dependes on the complexity of the operations and the experienced
performance.</p>
</div>
<div class="paragraph">
<p>To import a larger amount of data (more than 10k rows), it is
recommended to prefix the load csv clause with a <strong><code>PERIODIC COMMIT</code></strong>
hint. This allow the database to regularly commit the import
transactions to avoid memory churn for large transaction-states.</p>
</div>
</div>
<div class="sect4">
<h5 id="_exercises_part_sixteen">Exercises part sixteen</h5>
<div class="paragraph">
<p><strong><em>on neof4j browser run the command <code>:play intro-neo4j-exercises</code> and
follow exercise 16 instructions</em></strong></p>
</div>
<div class="paragraph">
<p>First of all use the script found at
Cypher/exercises/part_one/createGraph.cql to create the basic graph:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">Added 171 labels, created 171 nodes, set 564 properties, created 253 relationships, completed after 24 ms.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 16.1: You are given the name of a file,
<code><a href="http://data.neo4j.com/intro-neo4j/actors.csv" class="bare">http://data.neo4j.com/intro-neo4j/actors.csv</a></code> that you must load into
your graph.</p>
</div>
<div class="paragraph">
<p>Write the Cypher statement to read the actor data from a file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">LOAD CSV WITH HEADERS
FROM 'http://data.neo4j.com/intro-neo4j/actors.csv'
AS row
RETURN count(*)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">LOAD CSV WITH HEADERS
FROM 'http://data.neo4j.com/intro-neo4j/actors.csv'
AS row
RETURN row
LIMIT 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 16.2: Read the data and return it, ensuring that the data
returned is properly formatted.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">LOAD CSV WITH HEADERS
FROM 'http://data.neo4j.com/intro-neo4j/actors.csv'
AS row
RETURN row.id, row.name, toInteger(trim(row.birthYear))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 16.3: Load the data into your graph.</p>
</div>
<div class="paragraph">
<p>Hint: Use MERGE because the graph already contains some of these actors.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">LOAD CSV WITH HEADERS
FROM 'http://data.neo4j.com/intro-neo4j/actors.csv'
AS row
MERGE (actor:Person {name: row.name, born: toInteger(trim(row.birthYear))})
    ON CREATE SET actor.born = toInteger(trim(row.birthYear)), actor.id = row.id
    ON MATCH SET actor.id = row.id</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 16.4: You are given the name of a file,
<code><a href="http://data.neo4j.com/intro-neo4j/movies.csv" class="bare">http://data.neo4j.com/intro-neo4j/movies.csv</a></code> that you must load into
your graph.</p>
</div>
<div class="paragraph">
<p>Write the Cypher statement to read the movie data from a file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">LOAD CSV WITH HEADERS
FROM 'http://data.neo4j.com/intro-neo4j/movies.csv'
AS row
RETURN count(*)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">LOAD CSV WITH HEADERS
FROM 'http://data.neo4j.com/intro-neo4j/movies.csv'
AS row
RETURN row
LIMIT 1</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">LOAD CSV WITH HEADERS
FROM 'http://data.neo4j.com/intro-neo4j/movies.csv'
AS row
RETURN row.id, row.title, row.year, row.tagLine
LIMIT 10</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 16.5: Read the data and return it, ensuring that the data
returned is properly formatted.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">LOAD CSV WITH HEADERS
FROM 'http://data.neo4j.com/intro-neo4j/movies.csv'
AS row
RETURN row.id, row.title, toInteger(trim(row.year)), trim(row.tagLine)
LIMIT 10</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 16.6: Load the data into your graph.</p>
</div>
<div class="paragraph">
<p>Hint: Use MERGE because the graph already contains some of these movies.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">LOAD CSV WITH HEADERS
FROM 'http://data.neo4j.com/intro-neo4j/movies.csv'
AS row
MERGE (movie:Movie {title: row.title})
    ON CREATE SET movie.tagLine = trim(row.tagLine), movie.id = row.id, movie.released = toInteger(trim(row.year))
    ON MATCH SET movie.id = row.id</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 16.7: You are given the name of a file,
<code><a href="http://data.neo4j.com/intro-neo4j/roles.csv" class="bare">http://data.neo4j.com/intro-neo4j/roles.csv</a></code> that you must load into
your graph.</p>
</div>
<div class="paragraph">
<p>Write the Cypher statement to read the relationship data from a file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">LOAD CSV WITH HEADERS
FROM 'http://data.neo4j.com/intro-neo4j/roles.csv'
AS row FIELDTERMINATOR ';'
RETURN count(*)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">LOAD CSV WITH HEADERS
FROM 'http://data.neo4j.com/intro-neo4j/roles.csv'
AS row FIELDTERMINATOR ';'
RETURN row
LIMIT 1</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">LOAD CSV WITH HEADERS
FROM 'http://data.neo4j.com/intro-neo4j/roles.csv'
AS row FIELDTERMINATOR ';'
RETURN row.Role, row.personId, row.movieId
LIMIT 10</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 16.8: Read the data and return it, ensuring that the data
returned is properly formatted.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">LOAD CSV WITH HEADERS
FROM 'http://data.neo4j.com/intro-neo4j/roles.csv'
AS row FIELDTERMINATOR ';'
RETURN split(row.Role, ','), row.personId, row.movieId
LIMIT 10</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exercise 16.9: Load the data into your graph.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">LOAD CSV WITH HEADERS
FROM 'http://data.neo4j.com/intro-neo4j/roles.csv'
AS row FIELDTERMINATOR ';'
MATCH (pers:Person {id: row.personId}), (mov:Movie {id: row.movieId})
MERGE (pers)-[rol:ACTED_IN {role: split(row.Role, ',')}]-&gt;(mov)
RETURN pers, rol, mov</code></pre>
</div>
</div>
<hr>
</div>
<div class="sect4">
<h5 id="_libraries">Libraries</h5>
<div class="paragraph">
<p>Neo4j has a published, open source Cypher library, Awesome Procedures on
Cypher (<a href="https://github.com/neo4j-contrib/neo4j-apoc-procedures">APOC</a>)
that contain many useful procedures you can call from Cypher.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/neo4j-contrib/neo4j-graph-algorithms">Another Cypher
library is the Graph Algorithms library</a> to help users to analyze data
in graphs.</p>
</li>
<li>
<p>github &#8594;
<a href="https://github.com/neo4j-contrib/neo4j-apoc-procedures">github.com/neo4j-contrib/neo4j-apoc-procedures</a></p>
</li>
<li>
<p>neo4j docs &#8594;
<a href="https://neo4j-contrib.github.io/neo4j-apoc-procedures/">neo4j-contrib.github.io/neo4j-apoc-procedures/</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect3">
<h4 id="_how_to_learn_more">How to learn more</h4>
<div class="paragraph">
<p>There are many resources available to you for learning more about Neo4j
and Cypher.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://neo4j.com/developer/resources/">Resources for developers</a></p>
</li>
<li>
<p>Neo4j Community Site where you can ask or answer questions about Neo4j
and discuss with other users &#8594; <a href="https://community.neo4j.com">Community</a></p>
</li>
<li>
<p><a href="https://neo4j.com/docs/">Neo4j documentation</a></p>
</li>
<li>
<p><a href="https://neo4j.com/sandbox-v2/">Neo4j Sandboxes for experimenting with
graphs</a></p>
</li>
<li>
<p><a href="https://www.youtube.com/channel/UCvze3hU6OZBkB1vkhH2lH9Q">Videos on
YouTube</a></p>
</li>
<li>
<p><a href="https://github.com/neo4j-contrib">GitHub repository</a></p>
</li>
<li>
<p><a href="https://neo4j.com/events/world/all/">Neo4j events all over the world</a></p>
</li>
<li>
<p><a href="https://neo4j.com/graphacademy/">Neo4j online and classroom training</a></p>
</li>
<li>
<p><a href="https://neo4j.com/graphgists/">Graph Gists for learning more use cases
for Neo4j</a></p>
</li>
<li>
<p><a href="https://neo4j.com/graphacademy/neo4j-certification/">Become a Neo4j
certified developer</a></p>
</li>
<li>
<p><a href="https://www.meetup.com/topics/neo4j/">Attend a Neo4j meetup</a></p>
</li>
<li>
<p><a href="https://stackoverflow.com/tags/neo4j/hot">View questions/answers raised
about Neo4j</a></p>
</li>
</ul>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="_example_simple_graph">Example - Simple Graph</h4>
<div class="paragraph">
<p><strong><em>This example below is found on
<a href="https://www.youtube.com/watch?v=l76udM3wB4U">lesson 5 neo4j</a></em></strong></p>
</div>
<div class="paragraph">
<p>Let’s create this graph:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="resources/simpleGraphTemplate.PNG" alt="Simple Graph Creation"></span></p>
</div>
<div class="paragraph">
<p>To see the graph result you can use this query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH (p)
RETURN p</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Creation of the nodes:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CREATE (dan:Person {name:"Dan", born:"Dec 5, 1975"})
CREATE (ann:Person {name:"Ann", born: "May 29, 1970", twitter: "@ann"})
CREATE (car:Car {brand:"Volvo", model:"V70"})</code></pre>
</div>
</div>
<div class="paragraph">
<p>result:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="resources/simpleGraphCreate.PNG" alt="Create nodes"></span></p>
</div>
<div class="paragraph">
<p><strong><em>Query find on:
<a href="Cypher/SimpleGraph/CreationOfNodes.cql">creationNodes</a></em></strong></p>
</div>
</li>
<li>
<p>Creation of realtionships:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH
    (dan:Person {name: "Dan"}),
    (ann:Person {name: "Ann"}),
    (car:Car {model:"V70"})
CREATE
    (dan)-[:LOVES]-&gt;(ann),
    (ann)-[:LOVES]-&gt;(dan),
    (ann)-[:LIVES_WITH]-&gt;(dan),
    (dan)-[:OWNS]-&gt;(car),
    (dan)-[:DRIVES]-&gt;(car),
    (ann)-[:DRIVES]-&gt;(car)</code></pre>
</div>
</div>
<div class="paragraph">
<p>result:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="resources/simpleGraphRelationships.PNG" alt="Create relationships"></span></p>
</div>
<div class="paragraph">
<p><strong><em>Query find on:
<a href="Cypher/SimpleGraph/CreationOfRelationships.cql">creationRelationships</a></em></strong></p>
</div>
</li>
<li>
<p>Basic query</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>``Find who loves Ann'':</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH
    (ann:Person {name: "Ann"})&lt;-[:LOVES]-(op)
RETURN
    op</code></pre>
</div>
</div>
<div class="paragraph">
<p>The result is simple ``Dan''.</p>
</div>
<div class="paragraph">
<p><strong><em>Query find on: <a href="Cypher/SimpleGraph/lovesAnn.cql">lovesAnn</a></em></strong></p>
</div>
</li>
<li>
<p>``Find the Ann’s Car'':</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH
    (ann:Person {name: "Ann"})-[:DRIVES]-(car:Car)
RETURN
    car</code></pre>
</div>
</div>
<div class="paragraph">
<p>The result is simple ``Volvo''.</p>
</div>
<div class="paragraph">
<p><strong><em>Query find on: <a href="Cypher/SimpleGraph/annCar.cql">annCar</a></em></strong></p>
</div>
</li>
<li>
<p>``Find the Dan’s Volvo car and update value of that car with the
number of the wheels'':</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MATCH
    (ann:Person {name: "Dan"})-[:OWNS]-(car:Car)
WHERE
    car.brand="Volvo"
SET
    car.wheels=4
RETURN
    car.wheels</code></pre>
</div>
</div>
<div class="paragraph">
<p>The result is simple 4.</p>
</div>
<div class="paragraph">
<p><strong><em>Query find on:
<a href="Cypher/SimpleGraph/updateDanCar.cql">updateDanCar</a></em></strong></p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Ensuring uniqueness: We don’t want a bunch of nodes rapresenting the
same object so to prevent this we can use the constraint on and unique
properties</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CREATE CONSTRAINT ON (p:Person)
ASSERT p.name IS UNIQUE</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we create a node Person with the same value of name of others than
neo4j throws error. An example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">CREATE (a:Person {name:"Ann"})
CREATE (a)-[:HAS_PET]-&gt;(:Dog {name:"Sam"})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-error" data-lang="error">Neo.ClientError.Schema.ConstraintValidationFailed: Node(1) already exists with label `Person` and property `name` = 'Ann'</code></pre>
</div>
</div>
<div class="paragraph">
<p>To prevent this error we can use the MERGE clause:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MERGE (a:Person {name:"Ann"})
CREATE (a)-[:HAS_PET]-&gt;(:Dog {name:"Sam"})</code></pre>
</div>
</div>
<div class="paragraph">
<p>The node with name Ann will be created if is not exists and if exists
then it not create that. The new graph will be:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="resources/simpleGraphMerge.PNG" alt="merge"></span></p>
</div>
<div class="paragraph">
<p>In the same way if the dog already exists the above query will give you
an error, to prevent is necessary use MERGE instead of CREATE for the
Dog creation. An example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher">MERGE (a:Person {name:"Ann"})
ON CREATE SET
    a.facebook = "@annie"
MERGE (a)-[:HAS_PET]-&gt;(:Dog {name:"Sam"})</code></pre>
</div>
</div>
<div class="paragraph">
<p>On create set will be use only if the merge create the node, if you run
this query before all the queries above the facebook parameter will not
be created.</p>
</div>
<div class="paragraph">
<p><strong><em>Query find on:
<a href="Cypher/SimpleGraph/annDogCreation.cql">annDogCreation</a></em></strong></p>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="_index">Index</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#acid-consistency-model">ACID</a></p>
</li>
<li>
<p><a href="#cluster">Cluster</a></p>
</li>
<li>
<p><a href="#index-free-adjacency">index-free adjacency</a></p>
</li>
<li>
<p><a href="#oltp">OLTP</a></p>
</li>
<li>
<p><a href="#regular-expression">Regular expression</a></p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_acid_consistency_model">ACID consistency model</h4>
<div class="paragraph">
<p>The acronym stands for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Atomic &#8594; All operations in a transaction succeed or every operation
is rolled back</p>
</li>
<li>
<p>Consistent &#8594; On the completition of a transaction, the database is
structurally sound</p>
</li>
<li>
<p>Isolated &#8594; Transactions do not contend with one another. Contentious
access to data is moderated by database so that transactions appear to
run sequentially.</p>
</li>
<li>
<p>Durable &#8594; The results of applying a transaction are permanent, even
in the presence of failures</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This four properties mean that once a transaction is complete, its data
is consistent and stable on disk.</p>
</div>
<div class="paragraph">
<p>Most of graph databases (Neo4j incuded) use an ACID consistency model to
ensure data is safe and consistently stored.</p>
</div>
</div>
<div class="sect3">
<h4 id="_cluster">Cluster</h4>
<div class="paragraph">
<p>A cluster is when data is assembled around one particular value, on
graph usually happens when there are several nodes thet seem to gather
in a certain area. In other word a cluster is a group that are placed
closely next to each other in a certain area, with a few nodes scattered
in other places on the graph.</p>
</div>
<div class="paragraph">
<p>For example this is a social netowork graph:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="resources/facebookClusters.png" alt="cluster"></span></p>
</div>
<div class="paragraph">
<p>There are several aggregations of similar nodes that are colored.</p>
</div>
</div>
<div class="sect3">
<h4 id="_index_free_adjacency">index-free adjacency</h4>
<div class="paragraph">
<p>A graph database is any storage system that provides index-free
adjacency and this means that every element contains a direct pointer to
its adjacent element and no index lookups are necessary. This is one of
the most element of distinction from relational databases that are based
on a key-value store. The idea of an index-free adjacency is analogous
to that of a pointer where the time to follow the relationship is O(1)
with respect to the size of the graph, and this is not the cost of found
a relationship in a relational. To be more precise a relational database
use indexes but the aren’t used for adjacency or link purposes. With
Neo4j tipically a query will find the node to start from with an index
and then the resto fo the query simply follows relationships to compute
the answer. When create a new set of nodes it’s typical to create an
index of that type, see <a href="#Application-Northwind-Graph">northwind
graph</a>, this reduce the cost of every query run. Example:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="resources/simpleGraph.jpeg" alt="simple graph"></span></p>
</div>
<div class="paragraph">
<p>In a relational database if we want to switch from data <strong>A</strong> to data <strong>B</strong>
the step are:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The db prohibited you to access direct items via pointers, so you
need to ask for the permission.</p>
</li>
<li>
<p>The request permission line can be full of other request, wait for
your turn.</p>
</li>
<li>
<p>The central index of db search for the data you want in a list of
other data , the cost of search is O(n) with <strong>n</strong> number of the data
stored.</p>
</li>
<li>
<p>Once you get the memory pointer of that data you can go to <strong>B</strong> by
follow the memory allocations by hopping on memory.</p>
</li>
<li>
<p>The cost of this hopping is O(n), but at the end you can switch to
<strong>B</strong> and do your operations.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In a graph database like Neo4j all the nodes are connected to each other
by relationships, so in order to go from <strong>A</strong> to <strong>B</strong>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Get the relationships pointer</p>
</li>
<li>
<p>Point to node <strong>B</strong> wherever the type of the relationships are</p>
</li>
<li>
<p>Do operations on <strong>B</strong></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The cost in this case is O(1), a big difference in performance between a
classical relational db.</p>
</div>
</div>
<div class="sect3">
<h4 id="_oltp">OLTP</h4>
<div class="paragraph">
<p>This is an acronym that stands for Online transaction processing. The
term transaction in the realm of database transactions it denotes an
atomic change of state. The goals of OLTP applications are availability,
speed, cuncurrency and recoverability.</p>
</div>
<div class="paragraph">
<p>An OLTP system is a common data processing system like order entry,
retail sales and financial transaction systems.</p>
</div>
<div class="paragraph">
<p>The main characteristics of an OLTP environment are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Short response time</p>
</li>
<li>
<p>Small transactions</p>
</li>
<li>
<p>Data maintenance operations</p>
</li>
<li>
<p>Large user populations</p>
</li>
<li>
<p>High concurrency</p>
</li>
<li>
<p>Large data volumes</p>
</li>
<li>
<p>High availability</p>
</li>
<li>
<p>Lifecycle-related data usage</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The benefits of this environments are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Support for bigger databases</p>
</li>
<li>
<p>Partition maintenance operations for data maintenance</p>
</li>
<li>
<p>Potential higher concurrency through elimination of hot spots</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_regular_expression">Regular expression</h4>
<div class="paragraph">
<p>The phrase regular expressions, and consequently, regexes, is often used
to mean the specific, standard textual syntax for representing patterns
for matching text. Each character in a regular expression is either a
metacharacter, having a special meaning, or a regular character that has
a literal meaning. For example, in the regex a., a is a literal
character which matches just `a', while `.' is a meta character that
matches every character except a newline. Therefore, this regex matches,
for example, `a', or `ax', or `a0'. Together, metacharacters and literal
characters can be used to identify text of a given pattern, or process a
number of instances of it. Pattern matches may vary from a precise
equality to a very general similarity, as controlled by the
metacharacters. For example, . is a very general pattern, [a-z] (match
all lower case letters from `a' to `z') is less general and a is a
precise pattern (matches just `a'). The metacharacter syntax is designed
specifically to represent prescribed targets in a concise and flexible
way to direct the automation of text processing of a variety of input
data, in a form easy to type using a standard ASCII keyboard.</p>
</div>
<div class="paragraph">
<p>A very simple case of a regular expression in this syntax is to locate a
word spelled two different ways in a text editor, the regular expression
seriali[sz]e matches both <code>serialise'' and </code>serialize''. Wildcards
also achieve this, but are more limited in what they can pattern, as
they have fewer metacharacters and a simple language-base.</p>
</div>
<div class="paragraph">
<p>The usual context of wildcard characters is in globbing similar names in
a list of files, whereas regexes are usually employed in applications
that pattern-match text strings in general. For example, the regex
<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>|[ ]$ matches excess whitespace at the beginning or end of
a line. An advanced regular expression that matches any numeral is
[-]?((.)?|.)([eE][-]?)?.</p>
</div>
<div class="paragraph">
<p>For more read wikipedia &#8594;
<a href="https://en.wikipedia.org/wiki/Regular_expression">regex</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="_references">References</h4>
<div class="paragraph">
<p><a href="#graph-database-fundamentals">Graph database Fundamentals</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://neo4j.com/sandbox-v2/">neo4J browser sandbox</a> by type the
command <code>:play concepts</code></p>
</li>
<li>
<p><a href="https://neo4j.com/graphacademy/online-training/introduction-to-neo4j/part-1/">graphacademy</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Others:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="https://neo4j.com/graphacademy/online-training/introduction-to-neo4j/">neo4j
online course</a></p>
</li>
<li>
<p><a href="https://neo4j.com/docs/">neo4j docs</a></p>
</li>
<li>
<p><a href="https://github.com/neo4j/neo4j">neo4j repository</a></p>
</li>
<li>
<p><a href="https://neo4j.com/sandbox-v2">neo4j browser sandbox</a></p>
</li>
<li>
<p><a href="https://neo4j.com/developer/get-started/">neo4j developer get
started</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="https://neo4j.com/developer/cypher/">dev-cypher</a></p>
</li>
<li>
<p><a href="https://neo4j.com/developer/graph-database/">dev-graph-database</a></p>
</li>
<li>
<p><a href="https://neo4j.com/developer/data-modeling/">dev-graph-data-modeling</a></p>
</li>
<li>
<p><a href="https://neo4j.com/developer/graph-platform/">dev-graph-platform</a></p>
</li>
<li>
<p><a href="https://neo4j.com/developer/tools-graph-visualization/">dev-graph-visualization-tools</a></p>
</li>
<li>
<p><a href="https://neo4j.com/developer/language-guides/">dev-language-guide</a></p>
</li>
<li>
<p><a href="https://neo4j.com/developer/guide-import-csv/">dev-importing-csv-data</a></p>
</li>
<li>
<p><a href="https://neo4j.com/developer/integration/">dev-integration</a></p>
</li>
<li>
<p><a href="https://neo4j.com/developer/in-production/">dev-in-production</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://neo4j.com/docs/developer-manual/3.2">neo4j developer manual</a></p>
</li>
<li>
<p><a href="https://neo4j.com/graphacademy/">Graphacademy</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="https://neo4j.com/graphacademy/online-training/introduction-to-neo4j/">introduction</a></p>
</li>
<li>
<p><a href="https://www.youtube.com/playlist?list=PL9Hl4pk2FsvWM9GWaguRhlCQ-pa-ERd4U">YouTube
playlist</a>:</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. 
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2019-06-25 17:26:17
</div>
</div>
</body>
</html>